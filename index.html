<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>ê°œì¸ìš© ìŠ¤ìœ™ íŠ¸ë˜ì»¤ í™ˆ Â· Holographic (Mobile)</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Pretendard -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css" />
    <!-- React 18 -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase SDK (App, Auth, Firestore) -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
      import { getAuth, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
      import { getFirestore, doc, getDoc, setDoc, enableIndexedDbPersistence } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

      // ğŸ”§ ë„¤ í”„ë¡œì íŠ¸ ì„¤ì • (ê·¸ëŒ€ë¡œ ì‚¬ìš©)
      const firebaseConfig = {
        apiKey: "AIzaSyBmyHCDjElHWFruKUz1psMF_JlR8xXkdsc",
        authDomain: "stock-tracker-c5203.firebaseapp.com",
        projectId: "stock-tracker-c5203",
        storageBucket: "stock-tracker-c5203.firebasestorage.app",
        messagingSenderId: "653038109673",
        appId: "1:653038109673:web:cc17abb3796a6d4dff0178",
        measurementId: "G-JCT2JK3PP6"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      // ì˜¤í”„ë¼ì¸ ìºì‹œ(ë˜ë©´ ì¢‹ê³ , ì•ˆë¼ë„ ë¬´ì‹œ)
      enableIndexedDbPersistence(db).catch(() => {});

      // ìµëª… ë¡œê·¸ì¸ ë³´ì¥
      const userReady = new Promise((resolve) => {
        onAuthStateChanged(auth, async (user) => {
          if (!user) {
            await signInAnonymously(auth).catch(() => {});
          }
          resolve(auth.currentUser);
        });
      });

      // windowë¡œ ë…¸ì¶œí•´ì„œ Babel ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ
      window.__fb = { app, auth, db, userReady, getDoc, setDoc, doc };
    </script>

    <style>
      :root { --bg:#fff; --text:#111827; --muted:#6b7280; --shadow:0 6px 20px rgba(0,0,0,.06); --stroke:#e5e7eb; --safe:env(safe-area-inset-bottom,0px); }
      html,body{height:100%;}
      body{font-family:"Pretendard Variable",Pretendard,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Apple SD Gothic Neo","Malgun Gothic",sans-serif;background:var(--bg);color:var(--text);font-size:.9rem;}
      .glass-card{background:#fff;border:1px solid var(--stroke);border-radius:12px;box-shadow:var(--shadow);}
      .glass-input,.glass-select,.glass-textarea{background:#f9fafb;border:1px solid #e5e7eb;color:var(--text);border-radius:10px;transition:.2s ease;font-size:16px;}
      .glass-input:focus,.glass-select:focus,.glass-textarea:focus{outline:none;border-color:#93c5fd;box-shadow:0 0 0 3px rgba(147,197,253,.3);}
      .holo-btn{position:relative;border-radius:12px;padding:10px 14px;color:#0b1220;font-weight:400;cursor:pointer;border:1px solid transparent;background:
        linear-gradient(180deg,rgba(255,255,255,.95),rgba(255,255,255,.7)) padding-box,
        conic-gradient(from 180deg at 50% 50%,#7c3aed,#06b6d4,#22d3ee,#f472b6,#7c3aed) border-box;
        box-shadow:0 10px 24px rgba(0,0,0,.08), inset 0 1px 0 rgba(255,255,255,.7);transition:transform .15s ease, box-shadow .2s ease, background .3s ease;}
      .holo-btn:hover{transform:translateY(-1px);}
      .holo-btn:active{transform:translateY(1px);box-shadow:0 6px 16px rgba(0,0,0,.12), inset 0 1px 0 rgba(255,255,255,.8);}
      .holo-btn::after{content:"";position:absolute;inset:0;border-radius:12px;background:linear-gradient(120deg,rgba(255,255,255,.8),rgba(255,255,255,0) 42%);transform:translateY(-60%);filter:blur(6px);opacity:.35;pointer-events:none;}
      .glass-btn{border-radius:12px;padding:10px 12px;cursor:pointer;background:#f3f4f6;border:1px solid #e5e7eb;color:var(--text);font-size:.9rem;font-weight:400;transition:.2s ease;}
      .glass-btn:hover{transform:translateY(-1px);}
      .danger{color:#dc2626;border-color:#fecaca;}
      table thead{color:#374151;font-weight:400;} table tbody{color:#111827;} .table-cell{border-top:1px solid #f1f5f9;} .muted{color:var(--muted);}
      .sheet{position:fixed;left:0;right:0;bottom:0;z-index:50;background:#fff;border-top-left-radius:16px;border-top-right-radius:16px;box-shadow:0 -10px 30px rgba(0,0,0,.12);transform:translateY(100%);transition:transform .25s ease;padding-bottom:calc(12px + var(--safe));}
      .sheet.open{transform:translateY(0%);} .sheet-handle{width:40px;height:4px;border-radius:9999px;background:#e5e7eb;margin:8px auto 4px;}
      .fab{position:fixed;right:16px;bottom:calc(16px + var(--safe));z-index:40;} .meta-label{font-size:12px;color:#6b7280;}
    </style>
  </head>

  <body class="min-h-screen">
    <div id="root" class="min-h-screen"></div>

    <script type="text/babel">
      const { useState, useMemo, useEffect } = React;

      /* ---------------------- ë°ì´í„°/ìœ í‹¸ ---------------------- */
      const APP_KEY = "swing-home-v2-mobile";
      const STOCKS = [{key:"kakao",name:"ì¹´ì¹´ì˜¤"},{key:"samsung",name:"ì‚¼ì„±ì „ì"},{key:"sm",name:"ì—ìŠ¤ì— "}];

      const defaultJournalEntry = () => ({
        id: (crypto?.randomUUID?.() ?? String(Date.now()+Math.random())),
        date: new Date().toISOString().slice(0,10),
        side:"ë§¤ìˆ˜", qty:"", price:"", fees:"",
        plan:"", reason:"", target:"1% ì ˆë°˜ ìµì ˆ, 3~5% ì—°ì¥", stop:"ìµœëŒ€ -2%",
        emotion:3, outcome:"ì§„í–‰ì¤‘", resultPct:"", resultPnl:"", hold:false,
        tags:"ìŠ¤ìœ™", notes:""
      });

      const defaultState = {
        settings:{ initialSeed:16000000 },
        monthlyPnL:{},
        journals:{ kakao:[], samsung:[], sm:[] }
      };

      const currency = (n)=> Number(n||0).toLocaleString();
      const pct = (n)=> isFinite(n)? (Math.round(n*10)/10).toFixed(1):"0.0";

      // ì €ì¥ ê³¼ë„ ìš”ì²­ ë°©ì§€ìš© ë””ë°”ìš´ìŠ¤
      const debounce = (fn, ms=800) => {
        let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), ms); };
      };

      /* ---------------------- ë¡œì»¬+í´ë¼ìš°ë“œ ìƒíƒœ í›… ---------------------- */
      function useCloudedState(key, initial){
        // 1) ìš°ì„  ë¡œì»¬
        const [state, setState] = useState(()=>{
          try{
            const hash = new URLSearchParams(location.hash.replace(/^#/, "")).get("data");
            if (hash) return JSON.parse(atob(hash));
          }catch{}
          try{
            const raw = localStorage.getItem(key);
            return raw? JSON.parse(raw): initial;
          }catch{ return initial; }
        });

        // ë¡œì»¬ ì €ì¥
        useEffect(()=>{ try{ localStorage.setItem(key, JSON.stringify(state)); }catch{} }, [key, state]);

        // 2) íŒŒì´ì–´ë² ì´ìŠ¤ ë™ê¸°í™”
        useEffect(()=>{
          let unsub;
          (async ()=>{
            try{
              const fb = window.__fb;
              if (!fb) return; // SDK ë¯¸ì´ˆê¸°í™”ì‹œ ë¬´ì‹œ
              const user = await fb.userReady;
              if (!user) return;

              const docRef = fb.doc(fb.db, "users", user.uid, "state", key);
              // ìµœì´ˆ ê°€ì ¸ì˜¤ê¸°
              const snap = await fb.getDoc(docRef);
              if (snap.exists()){
                const remote = snap.data();
                // ìµœì‹ (ì—…ë°ì´íŠ¸ ì‹œê°) ê¸°ì¤€ ë³‘í•© (ë‹¨ìˆœ: remote ìš°ì„ )
                if (remote?.__updatedAt && (remote.__updatedAt >= (state.__updatedAt||0))){
                  setState(remote);
                }else{
                  // ë¡œì»¬ì´ ìµœì‹ ì´ë©´ ì—…ë¡œë“œ
                  await fb.setDoc(docRef, {...state, __updatedAt: Date.now()}, { merge:true });
                }
              }else{
                // ë¬¸ì„œê°€ ì—†ìœ¼ë©´ ì—…ë¡œë“œ
                await fb.setDoc(docRef, {...state, __updatedAt: Date.now()});
              }

              // ë¦¬ìŠ¤ë„ˆ (ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œ ë³€ê²½ë˜ë©´ ì‹¤ì‹œê°„ ë°˜ì˜)
              unsub = (await import("https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js"))
                .onSnapshot(docRef, (sn)=>{
                  if (!sn.exists()) return;
                  const d = sn.data();
                  // ë‚´ ì €ì¥ ë£¨í”„ì™€ ì¶©ëŒ ë°©ì§€: ë” ìµœì‹ ë§Œ ë°˜ì˜
                  if (d?.__updatedAt && d.__updatedAt > (state.__updatedAt||0)){
                    setState(d);
                  }
                });

              // ë³€ê²½ì‹œ ì €ì¥ (ë””ë°”ìš´ìŠ¤)
              const save = debounce(async (next)=>{
                try{
                  await fb.setDoc(docRef, {...next, __updatedAt: Date.now()}, { merge:true });
                }catch(e){}
              }, 900);

              // state ë³€ê²½ ê°ì§€ íš¨ê³¼
              const off = new MutationObserver(()=>{}); // dummy(ì°¸ì¡° ìœ ì§€)
              const stop = ()=> off.disconnect();
              // ê°„ë‹¨íˆ ë³„ë„ effectë¡œ êµ¬í˜„
              let prev = JSON.stringify(state);
              const i = setInterval(()=>{
                const cur = JSON.stringify(state);
                if (cur !== prev){
                  prev = cur;
                  save(JSON.parse(cur));
                }
              }, 600);
              // cleanup
              return ()=>{ clearInterval(i); stop(); };
            }catch(e){}
          })();
          return ()=>{ if (unsub) try{unsub();}catch{} };
        }, []); // ì´ˆê¸° 1íšŒ: ë¦¬ìŠ¤ë„ˆ ì„¤ì¹˜

        return [state, setState];
      }

      /* ---------------------- ê³µí†µ UI ---------------------- */
      const Section = ({title, right, children}) => (
        <div className="glass-card p-4">
          <div className="flex items-center justify-between mb-3">
            <h3 className="text-base font-normal">{title}</h3>
            <div className="flex items-center gap-2">{right}</div>
          </div>
          {children}
        </div>
      );

      const Stat = ({label, value, sub}) => (
        <div className="glass-card p-3">
          <div className="text-xs muted">{label}</div>
          <div className="text-lg font-normal">{value}</div>
          {sub && <div className="text-xs muted mt-1">{sub}</div>}
        </div>
      );

      function MonthlyPnLTable({ monthly, onChange }){
        const [year, setYear] = useState(new Date().getFullYear());
        const months = Array.from({length:12}, (_,i)=>i+1);
        const ym = (y,m)=> `${y}-${String(m).padStart(2,"0")}`;
        return (
          <div>
            <div className="flex items-center gap-2 mb-2">
              <span className="text-xs muted">ì—°ë„</span>
              <select className="glass-select px-2 py-1" value={year} onChange={e=>setYear(Number(e.target.value))}>
                {Array.from({length:6},(_,i)=>new Date().getFullYear()-3+i).map(y=><option key={y} value={y}>{y}</option>)}
              </select>
            </div>
            <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
              {months.map(m=>{
                const key = ym(year, m);
                const v = monthly[key] ?? "";
                return (
                  <div key={key} className="glass-card p-2">
                    <div className="text-xs muted mb-1">{year}ë…„ {m}ì›”</div>
                    <input className="glass-input w-full px-3 py-2 text-right" placeholder="ì˜ˆ: 140000" value={v}
                      onChange={e=>onChange(key, e.target.value)} />
                  </div>
                );
              })}
            </div>
          </div>
        );
      }

      function EditorSheet({ editing, setEditing, onSave }){
        if(!editing) return null;
        const { entry, stock } = editing;
        const update = (k,v)=> setEditing(p=> ({...p, entry:{...p.entry, [k]:v}}));
        return (
          <div className="sheet open">
            <div className="sheet-handle"></div>
            <div className="px-4 pt-2 pb-3">
              <div className="flex items-center justify-between">
                <div className="text-sm muted">ì¼ì§€ ì…ë ¥ Â· {stock}</div>
                <button className="glass-btn" onClick={()=>setEditing(null)}>ë‹«ê¸°</button>
              </div>

              <div className="grid grid-cols-2 gap-3 mt-3">
                <div><div className="text-xs muted mb-1">ë‚ ì§œ</div>
                  <input type="date" className="glass-input w-full px-3 py-2" value={entry.date} onChange={e=>update("date", e.target.value)}/>
                </div>
                <div><div className="text-xs muted mb-1">ì‚¬ì´ë“œ</div>
                  <select className="glass-input w-full px-3 py-2" value={entry.side} onChange={e=>update("side", e.target.value)}>
                    <option>ë§¤ìˆ˜</option><option>ë§¤ë„</option><option>ê´€ë§</option><option>ì²­ì‚°</option>
                  </select>
                </div>
                <div><div className="text-xs muted mb-1">ìˆ˜ëŸ‰</div>
                  <input inputMode="numeric" pattern="[0-9]*" className="glass-input w-full px-3 py-2" value={entry.qty} onChange={e=>update("qty", e.target.value)}/>
                </div>
                <div><div className="text-xs muted mb-1">ê°€ê²©</div>
                  <input inputMode="decimal" className="glass-input w-full px-3 py-2" value={entry.price} onChange={e=>update("price", e.target.value)}/>
                </div>
                <div><div className="text-xs muted mb-1">ìˆ˜ìˆ˜ë£Œ/ì„¸ê¸ˆ</div>
                  <input inputMode="decimal" className="glass-input w-full px-3 py-2" value={entry.fees} onChange={e=>update("fees", e.target.value)}/>
                </div>
                <div><div className="text-xs muted mb-1">ê°ì •(1~5)</div>
                  <input type="number" min="1" max="5" className="glass-input w-full px-3 py-2" value={entry.emotion} onChange={e=>update("emotion", e.target.value)}/>
                </div>
                <div className="col-span-2"><div className="text-xs muted mb-1">ë¶€ë¶„ìµì ˆ/ëª©í‘œ</div>
                  <input className="glass-input w-full px-3 py-2" value={entry.target} onChange={e=>update("target", e.target.value)}/>
                </div>
                <div className="col-span-2"><div className="text-xs muted mb-1">ë¦¬ìŠ¤í¬/ì†ì ˆ</div>
                  <input className="glass-input w-full px-3 py-2" value={entry.stop} onChange={e=>update("stop", e.target.value)}/>
                </div>
                <div className="col-span-2"><div className="text-xs muted mb-1">ì§„ì… ê³„íš(ì‹œë‚˜ë¦¬ì˜¤)</div>
                  <textarea rows="2" className="glass-input w-full px-3 py-2" value={entry.plan} onChange={e=>update("plan", e.target.value)}></textarea>
                </div>
                <div className="col-span-2"><div className="text-xs muted mb-1">ì‹¤í–‰/ì¢…ë£Œ ì´ìœ </div>
                  <textarea rows="2" className="glass-input w-full px-3 py-2" value={entry.reason} onChange={e=>update("reason", e.target.value)}></textarea>
                </div>
                <div><div className="text-xs muted mb-1">ì‹¤í˜„ ìˆ˜ìµë¥ (%)</div>
                  <input inputMode="decimal" className="glass-input w-full px-3 py-2" value={entry.resultPct} onChange={e=>update("resultPct", e.target.value)}/>
                </div>
                <div><div className="text-xs muted mb-1">ì‹¤í˜„ ì†ìµ(â‚©)</div>
                  <input inputMode="decimal" className="glass-input w-full px-3 py-2" value={entry.resultPnl} onChange={e=>update("resultPnl", e.target.value)}/>
                </div>
                <div><div className="text-xs muted mb-1">ë³´ìœ </div>
                  <select className="glass-input w-full px-3 py-2" value={entry.hold? "Y":"N"} onChange={e=>update("hold", e.target.value==="Y")}>
                    <option value="N">ì•„ë‹ˆì˜¤</option><option value="Y">ì˜ˆ</option>
                  </select>
                </div>
                <div><div className="text-xs muted mb-1">íƒœê·¸</div>
                  <input className="glass-input w-full px-3 py-2" value={entry.tags} onChange={e=>update("tags", e.target.value)}/>
                </div>
                <div className="col-span-2"><div className="text-xs muted mb-1">ë©”ëª¨</div>
                  <textarea rows="2" className="glass-input w-full px-3 py-2" value={entry.notes} onChange={e=>update("notes", e.target.value)}></textarea>
                </div>
              </div>

              <div className="sticky bottom-0 bg-white pt-3 mt-3">
                <div className="flex gap-2">
                  <button className="glass-btn flex-1" onClick={()=>setEditing(null)}>ì·¨ì†Œ</button>
                  <button className="holo-btn flex-1" onClick={onSave}>ì €ì¥</button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      /* ---------------------- ë©”ì¸ App ---------------------- */
      function App(){
        const [state, setState] = useCloudedState(APP_KEY, defaultState);
        const [tab, setTab] = useState("dashboard");
        const [stockTab, setStockTab] = useState(STOCKS[0].key);
        const [q, setQ] = useState("");
        const [sortKey, setSortKey] = useState("date");
        const [sortDir, setSortDir] = useState("desc");
        const [editing, setEditing] = useState(null);

        const realized = useMemo(()=>(
          ["kakao","samsung","sm"]
            .flatMap(k=>state.journals[k])
            .filter(e=>!e.hold && Number(e.resultPnl||0)!==0)
        ), [state]);

        const totals = useMemo(()=>{
          const monthlyTotal = Object.values(state.monthlyPnL).reduce((s,v)=>s+Number(v||0),0);
          const pnl = realized.reduce((s,e)=>s+Number(e.resultPnl||0),0);
          const initialSeed = Number(state.settings?.initialSeed || 0);
          const currentSeed = initialSeed + pnl;
          const roi = initialSeed>0 ? (pnl/initialSeed)*100 : 0;
          return { monthlyTotal, pnl, initialSeed, currentSeed, roi };
        }, [state, realized]);

        const filtered = useMemo(()=>{
          let arr = [...state.journals[stockTab]];
          if (q){
            const t=q.toLowerCase();
            arr = arr.filter(e=>[e.date,e.side,e.plan,e.reason,e.notes,e.tags].join(" ").toLowerCase().includes(t));
          }
          const dir = (sortDir==="asc"?1:-1);
          arr.sort((a,b)=> (a[sortKey]>b[sortKey]?dir:-dir));
          return arr;
        }, [state, stockTab, q, sortKey, sortDir]);

        function addEntry(stock){ setEditing({ stock, entry: defaultJournalEntry() }); }
        function editEntry(stock, id){ const e = state.journals[stock].find(x=>x.id===id); if (e) setEditing({ stock, entry: {...e} }); }
        function removeEntry(stock, id){
          if (!confirm("ì‚­ì œí• ê¹Œìš”?")) return;
          setState(prev=>({ ...prev, journals:{ ...prev.journals, [stock]: prev.journals[stock].filter(e=>e.id!==id) }}));
        }
        function saveEntry(){
          const { stock, entry } = editing;
          setState(prev=>{
            const exists = prev.journals[stock].some(e=>e.id===entry.id);
            const next = exists ? prev.journals[stock].map(e=>e.id===entry.id? entry: e) : [entry, ...prev.journals[stock]];
            return { ...prev, journals:{ ...prev.journals, [stock]: next }, __updatedAt: Date.now() };
          });
          setEditing(null);
        }

        const setMonthly = (ym, value)=> setState(prev=>({ ...prev, monthlyPnL:{ ...prev.monthlyPnL, [ym]: value }, __updatedAt: Date.now() }));
        const setInitialSeed = (v)=> setState(prev=>({ ...prev, settings:{ ...prev.settings, initialSeed: v }, __updatedAt: Date.now() }));

        return (
          <div className="max-w-7xl mx-auto p-4 pb-24">
            {/* í—¤ë” */}
            <div className="flex items-center justify-between mb-6">
              <div>
                <h1 className="text-xl font-normal tracking-tight">ê°œì¸ìš© ìŠ¤ìœ™ íŠ¸ë˜ì»¤ í™ˆ</h1>
                <p className="muted mt-1 text-sm">ì›” ìˆ˜ìµ ì§‘ê³„ + 3ì¢…ëª©(ì¹´ì¹´ì˜¤Â·ì‚¼ì„±ì „ìÂ·ì—ìŠ¤ì— ) ì¼ì§€ Â· ë¡œì»¬/í´ë¼ìš°ë“œ ì €ì¥</p>
              </div>
              <div className="flex gap-2">
                <button className={`glass-btn ${tab==='dashboard' && 'ring-2 ring-blue-200'}`} onClick={()=>setTab('dashboard')}>ëŒ€ì‹œë³´ë“œ</button>
                <button className={`glass-btn ${tab==='journal' && 'ring-2 ring-blue-200'}`} onClick={()=>setTab('journal')}>ì¼ì§€</button>
                <button className={`glass-btn ${tab==='settings' && 'ring-2 ring-blue-200'}`} onClick={()=>setTab('settings')}>ì„¤ì •</button>
              </div>
            </div>

            {/* ëŒ€ì‹œë³´ë“œ */}
            {tab==='dashboard' && (
              <div className="grid md:grid-cols-3 gap-4">
                <Section title="ì›”ë³„ ì‹¤í˜„ ì†ìµ">
                  <MonthlyPnLTable monthly={state.monthlyPnL} onChange={setMonthly} />
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mt-4">
                    <Stat label="ì›” í•©ê³„" value={`${currency(totals.monthlyTotal)} ì›`} />
                    <Stat label="í˜„ì¬ ì‹œë“œ" value={`${currency(totals.currentSeed)} ì›`} />
                    <Stat label="ìˆ˜ìµë¥ " value={`${pct(totals.roi)} %`} sub={`ì´ˆê¸° ì‹œë“œ: ${currency(totals.initialSeed)} ì›`} />
                    <Stat label="ì´ ì¼ì§€ ìˆ˜" value={`${['kakao','samsung','sm'].reduce((s,k)=>s+state.journals[k].length,0)} ê±´`} />
                  </div>
                </Section>

                <Section title="ë¹ ë¥¸ ì¶”ê°€">
                  <div className="flex flex-wrap gap-2">
                    {STOCKS.map(s=> (
                      <button key={s.key} className="holo-btn" onClick={()=>addEntry(s.key)}>ìƒˆ ì¼ì§€ ({s.name})</button>
                    ))}
                  </div>
                </Section>

                <Section title="ê°€ì´ë“œ">
                  <ul className="list-disc pl-5 text-xs muted space-y-1">
                    <li>ì„¤ì •ì—ì„œ <b>ì´ˆê¸° ì‹œë“œ</b>ë¥¼ ì…ë ¥í•˜ë©´ ëŒ€ì‹œë³´ë“œì˜ í˜„ì¬ ì‹œë“œÂ·ìˆ˜ìµë¥ ì— ë°˜ì˜ë¼ìš”.</li>
                    <li>ì¼ì§€ëŠ” í•˜ë‹¨ <b>ï¼‹</b> ë²„íŠ¼(ëª¨ë°”ì¼)ìœ¼ë¡œ ë¹ ë¥´ê²Œ ì¶”ê°€í•˜ì„¸ìš”.</li>
                    <li>JSON ë°±ì—…/ë³µì› + Firebase ë™ê¸°í™”ë¡œ ì•ˆì „í•˜ê²Œ ë³´ê´€ë©ë‹ˆë‹¤.</li>
                  </ul>
                </Section>
              </div>
            )}

            {/* ì¼ì§€ */}
            {tab==='journal' && (
              <div className="glass-card p-4">
                <div className="flex flex-wrap items-center justify-between gap-2 mb-3">
                  <div className="flex gap-2">
                    {STOCKS.map(s=> (
                      <button key={s.key} className={`glass-btn ${stockTab===s.key && 'ring-2 ring-blue-200'}`} onClick={()=>setStockTab(s.key)}>{s.name}</button>
                    ))}
                  </div>
                  <div className="flex items-center gap-2">
                    <input className="glass-input w-full max-w-[200px] px-3 py-2" placeholder="ê²€ìƒ‰" value={q} onChange={e=>setQ(e.target.value)} />
                    <select className="glass-select px-3 py-2" value={sortKey} onChange={e=>setSortKey(e.target.value)}>
                      <option value="date">ë‚ ì§œ</option><option value="resultPnl">ì†ìµ</option><option value="emotion">ê°ì •</option>
                    </select>
                    <select className="glass-select px-3 py-2" value={sortDir} onChange={e=>setSortDir(e.target.value)}>
                      <option value="desc">ë‚´ë¦¼</option><option value="asc">ì˜¤ë¦„</option>
                    </select>
                    <button className="holo-btn hidden md:inline-flex" onClick={()=>addEntry(stockTab)}>ìƒˆ ì¼ì§€</button>
                  </div>
                </div>

                {/* ë°ìŠ¤í¬í†± í…Œì´ë¸” */}
                <div className="overflow-auto rounded-xl border border-[#eef2f7] hidden md:block">
                  <table className="min-w-full text-sm">
                    <thead className="bg-[#f8fafc]">
                      <tr>{['ë‚ ì§œ','ì‚¬ì´ë“œ','ìˆ˜ëŸ‰','ê°€ê²©','ìˆ˜ìˆ˜ë£Œ','ì‹¤í˜„(%)','ì‹¤í˜„(â‚©)','ë³´ìœ ','ê°ì •','íƒœê·¸','ë©”ëª¨','ì‘ì—…'].map(h=> <th key={h} className="px-3 py-2 text-left whitespace-nowrap">{h}</th>)}</tr>
                    </thead>
                    <tbody>
                      {filtered.map(e=> (
                        <tr key={e.id} className="hover:bg-[#fafafa]">
                          <td className="px-3 py-2 whitespace-nowrap table-cell">{e.date}</td>
                          <td className="px-3 py-2 whitespace-nowrap table-cell">{e.side}</td>
                          <td className="px-3 py-2 text-right table-cell">{e.qty}</td>
                          <td className="px-3 py-2 text-right table-cell">{e.price}</td>
                          <td className="px-3 py-2 text-right table-cell">{e.fees}</td>
                          <td className="px-3 py-2 text-right table-cell">{e.resultPct}</td>
                          <td className={`px-3 py-2 text-right table-cell ${Number(e.resultPnl||0)>=0? 'text-emerald-600':'text-rose-600'}`}>{e.resultPnl}</td>
                          <td className="px-3 py-2 table-cell">{e.hold? 'ë³´ìœ ':'-'}</td>
                          <td className="px-3 py-2 text-center table-cell">{e.emotion}</td>
                          <td className="px-3 py-2 table-cell">{e.tags}</td>
                          <td className="px-3 py-2 max-w-[240px] truncate table-cell" title={e.notes}>{e.notes}</td>
                          <td className="px-3 py-2 whitespace-nowrap table-cell">
                            <div className="flex gap-2">
                              <button className="glass-btn" onClick={()=>editEntry(stockTab, e.id)}>ìˆ˜ì •</button>
                              <button className="glass-btn danger" onClick={()=>removeEntry(stockTab, e.id)}>ì‚­ì œ</button>
                            </div>
                          </td>
                        </tr>
                      ))}
                      {filtered.length===0 && (<tr><td colSpan="12" className="px-3 py-10 text-center muted">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ìš°ìƒë‹¨ â€œìƒˆ ì¼ì§€â€.</td></tr>)}
                    </tbody>
                  </table>
                </div>

                {/* ëª¨ë°”ì¼ ì¹´ë“œ */}
                <div className="space-y-2 md:hidden">
                  {filtered.map(e=>(
                    <div key={e.id} className="border border-[#eef2f7] rounded-xl p-3">
                      <div className="flex items-center justify-between">
                        <div className="text-sm">{e.date} Â· <span className="muted">{e.side}</span></div>
                        <div className={`${Number(e.resultPnl||0)>=0?'text-emerald-600':'text-rose-600'} text-sm`}>{e.resultPnl||'-'}</div>
                      </div>
                      <div className="grid grid-cols-2 gap-x-4 gap-y-1 mt-2 text-[13px]">
                        <div><span className="meta-label">ìˆ˜ëŸ‰</span> {e.qty||'-'}</div>
                        <div><span className="meta-label">ê°€ê²©</span> {e.price||'-'}</div>
                        <div><span className="meta-label">ìˆ˜ìˆ˜ë£Œ</span> {e.fees||'-'}</div>
                        <div><span className="meta-label">ì‹¤í˜„(%)</span> {e.resultPct||'-'}</div>
                        <div><span className="meta-label">íƒœê·¸</span> {e.tags||'-'}</div>
                        <div><span className="meta-label">ê°ì •</span> {e.emotion||'-'}</div>
                      </div>
                      {e.notes && <div className="mt-2 text-[13px] text-gray-600">{e.notes}</div>}
                      <div className="mt-3 flex gap-2">
                        <button className="glass-btn" onClick={()=>editEntry(stockTab, e.id)}>ìˆ˜ì •</button>
                        <button className="glass-btn danger" onClick={()=>removeEntry(stockTab, e.id)}>ì‚­ì œ</button>
                      </div>
                    </div>
                  ))}
                  {filtered.length===0 && <div className="text-center muted py-6 text-sm">ì•„ì§ ê¸°ë¡ì´ ì—†ì–´ìš”. ìš°í•˜ë‹¨ <b>+</b> ë²„íŠ¼ìœ¼ë¡œ ì¶”ê°€!</div>}
                </div>
              </div>
            )}

            {/* ì„¤ì • */}
            {tab==='settings' && (
              <div className="grid md:grid-cols-2 gap-4">
                <Section title="ì´ˆê¸° ì‹œë“œ">
                  <div className="flex items-center gap-2">
                    <input inputMode="numeric" pattern="[0-9]*" className="glass-input w-48 px-3 py-2 text-right"
                      value={state.settings.initialSeed}
                      onChange={e=>{ const v = Number(String(e.target.value).replace(/[^0-9]/g,'')||0); setInitialSeed(v); }}/>
                    <span className="text-sm">ì›</span>
                  </div>
                  <p className="text-xs muted mt-2">ëŒ€ì‹œë³´ë“œì˜ <b>í˜„ì¬ ì‹œë“œ</b>ì™€ <b>ìˆ˜ìµë¥ </b> ê³„ì‚°ì— ì‚¬ìš©ë©ë‹ˆë‹¤.</p>
                </Section>

                <Section title="ë°±ì—…/ë³µì› (JSON)">
                  <div className="flex flex-wrap gap-2">
                    <button className="glass-btn" onClick={()=>{
                      const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
                      const url=URL.createObjectURL(blob); const a=document.createElement('a');
                      a.href=url; a.download=`swing-tracker-backup-${Date.now()}.json`; a.click(); URL.revokeObjectURL(url);
                    }}>JSON ë°±ì—…</button>
                    <label className="glass-btn cursor-pointer">ë³µì›
                      <input type="file" accept="application/json" className="hidden" onChange={e=>{
                        const f=e.target.files?.[0]; if(!f) return;
                        const r=new FileReader(); r.onload=()=>{ try{ const data=JSON.parse(r.result); data.__updatedAt=Date.now(); setState(data);}catch{ alert('í˜•ì‹ ì˜¤ë¥˜'); } }; r.readAsText(f);
                      }}/>
                    </label>
                  </div>
                  <p className="text-xs muted mt-2">* ë°ì´í„°ëŠ” ë¡œì»¬ê³¼ Firebase ëª¨ë‘ì— ë™ê¸°í™”ë©ë‹ˆë‹¤.</p>
                </Section>

                <Section title="í´ë¼ìš°ë“œ ë™ê¸°í™” ìƒíƒœ">
                  <CloudStatus />
                </Section>
              </div>
            )}

            <footer className="text-center text-xs muted py-8">ìŠ¤ìœ™ íˆ¬ì ë¶„ì„ ì¡°ì–¸ê°€ Â· ê°œì¸ìš© íŠ¸ë˜ì»¤ Â· Mobile + Cloud</footer>

            {/* ëª¨ë°”ì¼ FAB */}
            {tab!=='settings' && (
              <div className="fab md:hidden">
                <button className="holo-btn text-base px-4 py-3" aria-label="ìƒˆ ì¼ì§€ ì¶”ê°€" onClick={()=>addEntry(stockTab)}>ï¼‹</button>
              </div>
            )}

            {/* ë°”í…€ì‹œíŠ¸ í¸ì§‘ê¸° */}
            <EditorSheet editing={editing} setEditing={setEditing} onSave={saveEntry}/>
          </div>
        );
      }

      // ê°„ë‹¨í•œ í´ë¼ìš°ë“œ ìƒíƒœ í‘œì‹œ ì»´í¬ë„ŒíŠ¸
      function CloudStatus(){
        const fb = window.__fb;
        const [uid, setUid] = useState(null);
        useEffect(()=>{ (async()=>{ try{ const u = await fb?.userReady; setUid(u?.uid || null); }catch{} })(); },[]);
        return (
          <div className="text-sm">
            <div className="mb-2">ë¡œê·¸ì¸: <span className="muted">{uid? 'ìµëª… ('+uid.slice(0,8)+'â€¦)':'í™•ì¸ ì¤‘â€¦'}</span></div>
            <div className="muted">* ë™ì¼ ê¸°ê¸°/ë¸Œë¼ìš°ì €ë©´ ê°™ì€ ìµëª… ê³„ì •ìœ¼ë¡œ ì´ì–´ì ¸ìš”.</div>
          </div>
        );
      }

      const rootEl = document.getElementById("root");
      ReactDOM.createRoot(rootEl).render(<App/>);
    </script>
  </body>
</html>