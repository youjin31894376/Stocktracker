<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>stock tracker Â· Holographic</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Pretendard -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css"/>

  <!-- Cursive Title Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">

  <!-- React 18 + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    :root{
      --bg2:#f9fbff;
      --text:#0f172a;
      --muted:#667085;
      --stroke:#e5e7eb;
      --shadow:0 10px 30px rgba(2, 6, 23, .08);
    }
    html, body { height:100%; }
    body{
      font-family: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Apple SD Gothic Neo","Malgun Gothic",sans-serif;
      color:var(--text);
      background:
        radial-gradient(600px 300px at 7% 4%, #c7e8ff, transparent 60%),
        radial-gradient(520px 330px at 94% 10%, #ffd6f0, transparent 55%),
        linear-gradient(180deg, var(--bg2), #f4f6ff 55%, #f8f2ff 100%);
    }

    /* ìœ ë¦¬ ì¹´ë“œ */
    .glass {
      background: rgba(255,255,255,.72);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border:1px solid rgba(255,255,255,.55);
      border-radius: 18px;
      box-shadow: var(--shadow);
    }
    .glass-soft { background: rgba(255,255,255,.58); }

    /* í™€ë¡œ ìŠ¤íƒ€ì¼ ë³€ìˆ˜ */
    .holo-border{
      background:
        linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.75)) padding-box,
        conic-gradient(from 180deg, #7c3aed, #06b6d4, #22d3ee, #f472b6, #7c3aed) border-box;
      border:1px solid transparent;
    }

    /* íƒ­(ëŒ€ì‹œë³´ë“œ/ì¼ì§€/ì„¤ì •) â€“ í™€ë¡œê·¸ë¨ */
    .tab{
      border-radius:12px; padding:.46rem .85rem; font-weight:500;
      transition:.2s;
      box-shadow: 0 8px 20px rgba(2,6,23,.07), inset 0 1px 0 rgba(255,255,255,.7);
    }
    .tab:not(.active){ background:rgba(255,255,255,.7); border:1px solid rgba(255,255,255,.7); }
    .tab.active{ composes: holo-border; }
    .tab:hover{ transform: translateY(-1px); }

    /* ìœ ë¦¬ ë²„íŠ¼ */
    .holo-btn{
      composes: holo-border;
      border-radius:14px;
      padding:.55rem .9rem;
      color:#0b1220;
      transition:.2s;
      box-shadow: 0 10px 24px rgba(2, 6, 23, .07), inset 0 1px 0 rgba(255,255,255,.7);
    }
    .holo-btn:hover{ transform: translateY(-1px); }
    .holo-btn:active{ transform: translateY(1px); }

    /* ìºëŸ¬ì…€: í•˜ë‚˜ë§Œ ë³´ì´ê²Œ */
    .deck{ position:relative; height:min(620px, 70vh); display:grid; place-items:center; overflow:visible; }
    .slide{
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      opacity:0; visibility:hidden; pointer-events:none;
      transform: scale(.96); filter: blur(14px);
      transition: opacity .35s ease, transform .35s ease, filter .35s ease, visibility .35s;
    }
    .slide.active{ opacity:1; visibility:visible; pointer-events:auto; transform: scale(1); filter: blur(0); z-index:3; }

    /* ì¢Œìš° í™”ì‚´ â€“ ë” íˆ¬ëª…í•œ ìœ ë¦¬ì•Œ + í´ë¦­ ë³´ì¥(z-index) */
    .nav-fab{
      position:absolute; top:50%; transform:translateY(-50%);
      width:46px; height:46px; display:grid; place-items:center;
      border-radius:999px; z-index:20; cursor:pointer;
      background: rgba(255,255,255,.45);
      border:1px solid rgba(255,255,255,.75);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 12px 28px rgba(2,6,23,.10), inset 0 1px 0 rgba(255,255,255,.8);
      transition: transform .18s ease, box-shadow .2s ease, background .2s ease;
    }
    .nav-fab:hover{ transform:translateY(-50%) scale(1.07); background: rgba(255,255,255,.6); }
    .nav-left{ left:clamp(8px, 4vw, 80px);}
    .nav-right{ right:clamp(8px, 4vw, 80px);}

    /* íˆ¬ëª… ìŠ¤í¬ë¡¤ë°” */
    *{ scrollbar-width:thin; scrollbar-color: rgba(255,255,255,.35) transparent; }
    *::-webkit-scrollbar{ height:8px; width:8px; }
    *::-webkit-scrollbar-track{ background: transparent; }
    *::-webkit-scrollbar-thumb{
      background: linear-gradient(180deg, rgba(255,255,255,.6), rgba(255,255,255,.25));
      border-radius: 999px; border:1px solid rgba(255,255,255,.6);
    }

    .brand{ font-family:"Great Vibes", cursive; font-size: clamp(28px, 5vw, 42px); line-height:1; color:#0f172a; text-shadow: 0 2px 10px rgba(255,255,255,.7); }
    .muted{ color:var(--muted); }
    .chip{ background:#f3f4f6; border:1px solid var(--stroke); border-radius:12px; padding:.35rem .6rem; }
    .cell{ background:#fff; border:1px solid #eef2f7; border-radius:14px; padding:.65rem .8rem; }
  </style>
</head>
<body>
  <div id="root" class="min-h-screen"></div>

  <script type="text/babel">
    const {useState,useMemo,useEffect} = React;

    const APP_KEY = "swing-home-v3-holo";
    const STOCKS = [
      {key:"kakao", name:"ì¹´ì¹´ì˜¤"},
      {key:"samsung", name:"ì‚¼ì„±ì „ì"},
      {key:"sm", name:"ì—ìŠ¤ì— "},
    ];

    const defaultJournal = ()=>({
      id: (crypto?.randomUUID?.() ?? String(Date.now()+Math.random())),
      date: new Date().toISOString().slice(0,10),
      side: 'ë§¤ìˆ˜',
      qty:'', price:'',
      plan:'', reason:'',
      target:'1% ì ˆë°˜ ìµì ˆ, 3~5% ì—°ì¥',
      stop:'ìµœëŒ€ -2%',
      resultPct:'', resultPnl:'',
      hold:false, tags:'ìŠ¤ìœ™',
      good:'', feedback:''
    });

    const defaultState = {
      settings:{ initialSeed:16000000 },
      monthlyPnL:{},
      journals:{ kakao:[], samsung:[], sm:[] }
    };

    function useLocalState(key, initial){
      const [state, setState] = useState(()=>{
        try{
          const hash = new URLSearchParams(location.hash.replace(/^#/,'')).get('data');
          if(hash) return JSON.parse(atob(hash));
        }catch(e){}
        try{
          const raw = localStorage.getItem(key);
          return raw? JSON.parse(raw): initial;
        }catch(e){ return initial; }
      });
      useEffect(()=>{ try{ localStorage.setItem(key, JSON.stringify(state)); }catch(e){} }, [state]);
      return [state, setState];
    }

    const currency = n => Number(n||0).toLocaleString();
    const pct = n => isFinite(n)? (Math.round(n*10)/10).toFixed(1): '0.0';

    const Section = ({title, right, children, className=""})=>{
      return (
        <div className={"glass p-5 md:p-6 w-[min(760px,92vw)] "+className}>
          <div className="flex items-center justify-between mb-3">
            <h3 className="font-medium text-[15px]">{title}</h3>
            {right}
          </div>
          {children}
        </div>
      );
    };

    /* ì‘ì€ í†µê³„ ì»´í¬ë„ŒíŠ¸ */
    const AppCtx = React.createContext({totals:{}, count:0});
    const Stat = ({label, value})=>(
      <div className="glass-soft p-3 rounded-xl">
        <div className="text-[11px] muted">{label}</div>
        <div className="text-[15px] md:text-base font-medium">{value}</div>
      </div>
    );
    function SeedStat(){ const {totals}=React.useContext(AppCtx); return <Stat label="í˜„ì¬ ì‹œë“œ" value={`${currency(totals.currentSeed)} ì›`} />; }
    function RoiStat(){ const {totals}=React.useContext(AppCtx); return <Stat label="ìˆ˜ìµë¥ " value={`${pct(totals.roi)} %`} />; }
    function CountStat(){ const {count}=React.useContext(AppCtx); return <Stat label="ì´ ì¼ì§€ ìˆ˜" value={`${count} ê±´`} />; }

    /* 1) ì›”ë³„ ì†ìµ */
    function Monthly({state, setMonthly}){
      const [year, setYear] = useState(new Date().getFullYear());
      const months = Array.from({length:12}, (_,i)=> i+1);
      const ym = (y,m)=> `${y}-${String(m).padStart(2,'0')}`;

      const totals = useMemo(()=>{
        const monthlyTotal = Object.values(state.monthlyPnL).reduce((s,v)=>s+Number(v||0),0);
        return { monthlyTotal };
      }, [state]);

      return (
        <Section title="ì›”ë³„ ì‹¤í˜„ ì†ìµ" right={<button className="chip text-[12px]">í¸ì§‘</button>}>
          <div className="flex items-center gap-2 mb-3">
            <span className="text-xs muted">ì—°ë„</span>
            <select className="chip text-xs" value={year} onChange={e=>setYear(Number(e.target.value))}>
              {Array.from({length:6},(_,i)=> new Date().getFullYear()-3+i).map(y=> <option key={y} value={y}>{y}</option>)}
            </select>
          </div>

          <div className="grid grid-cols-2 md:grid-cols-3 gap-3 max-h-[46vh] overflow-auto pr-1">
            {months.map(m=>{
              const key = ym(year, m);
              const v = state.monthlyPnL[key] ?? '';
              return (
                <div key={key} className="cell">
                  <div className="text-[11px] muted mb-1">{m}ì›”</div>
                  <input
                    className="w-full chip text-center text-[13px]"  <!-- ê°€ìš´ë° ì •ë ¬ + í°íŠ¸ ì¶•ì†Œ -->
                    placeholder="ì˜ˆì‹œ: 140000"
                    value={v}
                    onChange={e=>setMonthly(key, e.target.value)}
                  />
                </div>
              );
            })}
          </div>

          <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mt-4">
            <Stat label="ì›” í•©ê³„" value={`${currency(totals.monthlyTotal)} ì›`} />
            <SeedStat/>
            <RoiStat/>
            <CountStat/>
          </div>
        </Section>
      );
    }

    /* 2) ìƒˆ ì¼ì§€ */
    function QuickAdd({add}){
      return (
        <Section title="ìƒˆ ì¼ì§€">
          <div className="flex flex-wrap gap-2">
            {STOCKS.map(s=>(
              <button key={s.key} className="holo-btn" onClick={()=>add(s.key)}>{s.name}</button>
            ))}
          </div>
          <p className="text-[12px] muted mt-3">ë²„íŠ¼ì„ ëˆŒëŸ¬ ë°”ë¡œ ì¼ì§€ ì‹œíŠ¸ë¥¼ ì—´ ìˆ˜ ìˆì–´ìš”.</p>
        </Section>
      );
    }

    /* 3) ê°€ì´ë“œ */
    function Guide(){
      return (
        <Section title="ê°€ì´ë“œ">
          <ul className="list-disc pl-5 text-[13px] space-y-1 muted">
            <li>ì›”ë³„ ê¸ˆì•¡ì€ í¸ì§‘ì„ ëˆŒëŸ¬ ì…ë ¥í•´ ë‘ë©´ ì €ì¥ë¼ìš”.</li>
            <li>ì¢Œìš° ã€ˆ, ã€‰ ìœ ë¦¬ ë²„íŠ¼ìœ¼ë¡œ ì¹´ë“œ ì´ë™.</li>
            <li>ì¼ì§€ëŠ” â€˜ì˜í•œ ì /í”¼ë“œë°±â€™ìœ¼ë¡œ ë‚˜ëˆ  ê¸°ë¡í•©ë‹ˆë‹¤.</li>
            <li>ëª¨ë“  ë°ì´í„°ëŠ” ì´ ê¸°ê¸°ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.</li>
          </ul>
        </Section>
      );
    }

    /* í¸ì§‘ ì‹œíŠ¸ */
    function EditorSheet({editing, setEditing, onSave}){
      if(!editing) return null;
      const {entry, stock} = editing;
      const upd = (k,v)=> setEditing(p=> ({...p, entry:{...p.entry, [k]:v}}));

      return (
        <div className="fixed inset-0 z-50">
          <div className="absolute inset-0 bg-black/30" onClick={()=>setEditing(null)}></div>
          <div className="absolute left-0 right-0 bottom-0 glass p-4 rounded-t-2xl">
            <div className="flex items-center justify-between">
              <div className="text-sm muted">ì¼ì§€ ì…ë ¥ Â· {stock}</div>
              <button className="chip" onClick={()=>setEditing(null)}>ë‹«ê¸°</button>
            </div>

            <div className="grid grid-cols-2 gap-3 mt-3">
              <div><div className="text-xs muted mb-1">ë‚ ì§œ</div>
                <input type="date" className="chip w-full" value={entry.date} onChange={e=>upd('date', e.target.value)}/></div>
              <div><div className="text-xs muted mb-1">ì‚¬ì´ë“œ</div>
                <select className="chip w-full" value={entry.side} onChange={e=>upd('side', e.target.value)}>
                  <option>ë§¤ìˆ˜</option><option>ë§¤ë„</option><option>ê´€ë§</option><option>ì²­ì‚°</option>
                </select></div>

              <div><div className="text-xs muted mb-1">ìˆ˜ëŸ‰</div>
                <input className="chip w-full" value={entry.qty} onChange={e=>upd('qty', e.target.value)}/></div>
              <div><div className="text-xs muted mb-1">ê°€ê²©</div>
                <input className="chip w-full" value={entry.price} onChange={e=>upd('price', e.target.value)}/></div>

              <div className="col-span-2"><div className="text-xs muted mb-1">ë¶€ë¶„ìµì ˆ/ëª©í‘œ</div>
                <input className="chip w-full" value={entry.target} onChange={e=>upd('target', e.target.value)}/></div>
              <div className="col-span-2"><div className="text-xs muted mb-1">ë¦¬ìŠ¤í¬/ì†ì ˆ</div>
                <input className="chip w-full" value={entry.stop} onChange={e=>upd('stop', e.target.value)}/></div>

              <div className="col-span-2"><div className="text-xs muted mb-1">ì§„ì… ê³„íš(ì‹œë‚˜ë¦¬ì˜¤)</div>
                <textarea rows="2" className="chip w-full" value={entry.plan} onChange={e=>upd('plan', e.target.value)}/></div>
              <div className="col-span-2"><div className="text-xs muted mb-1">ì‹¤í–‰/ì¢…ë£Œ ì´ìœ </div>
                <textarea rows="2" className="chip w-full" value={entry.reason} onChange={e=>upd('reason', e.target.value)}/></div>

              <div><div className="text-xs muted mb-1">ì‹¤í˜„ ìˆ˜ìµë¥ (%)</div>
                <input className="chip w-full" value={entry.resultPct} onChange={e=>upd('resultPct', e.target.value)}/></div>
              <div><div className="text-xs muted mb-1">ì‹¤í˜„ ì†ìµ(â‚©)</div>
                <input className="chip w-full" value={entry.resultPnl} onChange={e=>upd('resultPnl', e.target.value)}/></div>

              <div><div className="text-xs muted mb-1">ë³´ìœ </div>
                <select className="chip w-full" value={entry.hold? 'Y':'N'} onChange={e=>upd('hold', e.target.value==='Y')}>
                  <option value="N">ì•„ë‹ˆì˜¤</option><option value="Y">ì˜ˆ</option></select></div>
              <div><div className="text-xs muted mb-1">íƒœê·¸</div>
                <input className="chip w-full" value={entry.tags} onChange={e=>upd('tags', e.target.value)}/></div>

              <div className="col-span-2"><div className="text-xs muted mb-1">ì˜í•œ ì </div>
                <textarea rows="2" className="chip w-full" value={entry.good} onChange={e=>upd('good', e.target.value)}/></div>
              <div className="col-span-2"><div className="text-xs muted mb-1">í”¼ë“œë°±</div>
                <textarea rows="3" className="chip w-full" value={entry.feedback} onChange={e=>upd('feedback', e.target.value)}/></div>
            </div>

            <div className="mt-3 flex gap-2">
              <button className="chip flex-1" onClick={()=>setEditing(null)}>ì·¨ì†Œ</button>
              <button className="holo-btn flex-1" onClick={onSave}>ì €ì¥</button>
            </div>
          </div>
        </div>
      );
    }

    /* ì¼ì§€ í˜ì´ì§€ */
    function JournalPage({state,setState,stockTab,setStockTab,onEdit}){
      const [q, setQ] = useState('');
      const [sortKey, setSortKey] = useState('date');
      const [sortDir, setSortDir] = useState('desc');

      const filtered = React.useMemo(()=>{
        let arr=[...state.journals[stockTab]];
        if(q){
          const t=q.toLowerCase();
          arr=arr.filter(e=> [e.date,e.side,e.plan,e.reason,e.notes,e.tags,e.good,e.feedback].join(' ').toLowerCase().includes(t));
        }
        const dir=(sortDir==='asc'?1:-1);
        arr.sort((a,b)=> (a[sortKey]>b[sortKey]? dir:-dir));
        return arr;
      }, [state, stockTab, q, sortKey, sortDir]);

      const removeEntry = (id)=>{
        if(!confirm('ì‚­ì œí• ê¹Œìš”?')) return;
        setState(prev=> ({...prev, journals:{...prev.journals, [stockTab]: prev.journals[stockTab].filter(e=>e.id!==id)}}));
      };

      return (
        <div className="glass p-4 mt-8">
          <div className="flex flex-wrap items-center justify-between gap-2 mb-3">
            <div className="flex gap-2">
              {STOCKS.map(s=>(
                <button key={s.key} className={"chip "+(stockTab===s.key?'ring-2 ring-blue-200':'')} onClick={()=>setStockTab(s.key)}>{s.name}</button>
              ))}
            </div>
            <div className="flex items-center gap-2">
              <input className="chip w-[200px]" placeholder="ê²€ìƒ‰" value={q} onChange={e=>setQ(e.target.value)}/>
              <select className="chip" value={sortKey} onChange={e=>setSortKey(e.target.value)}>
                <option value="date">ë‚ ì§œ</option>
                <option value="resultPnl">ì†ìµ</option>
              </select>
              <select className="chip" value={sortDir} onChange={e=>setSortDir(e.target.value)}>
                <option value="desc">ë‚´ë¦¼</option>
                <option value="asc">ì˜¤ë¦„</option>
              </select>
              <button className="holo-btn" onClick={()=> alert('ëŒ€ì‹œë³´ë“œ > ìƒˆ ì¼ì§€ì—ì„œ ì¶”ê°€í•´ì£¼ì„¸ìš” ğŸ˜Š')}>ìƒˆ ì¼ì§€</button>
            </div>
          </div>

          {/* ëª¨ë°”ì¼ ì¹´ë“œ: í”¼ë“œë°±ë§Œ ë…¸ì¶œ */}
          <div className="space-y-2 md:hidden">
            {filtered.map(e=>(
              <div key={e.id} className="glass p-3 rounded-xl">
                <div className="flex items-center justify-between">
                  <div className="text-sm">{e.date} Â· <span className="muted">{e.side}</span></div>
                </div>
                <div className="grid grid-cols-2 gap-x-4 gap-y-1 mt-2 text-[13px]">
                  <div><span className="muted text-[12px]">ìˆ˜ëŸ‰</span> {e.qty||'-'}</div>
                  <div><span className="muted text-[12px]">ê°€ê²©</span> {e.price||'-'}</div>
                  <div><span className="muted text-[12px]">ì‹¤í˜„(%)</span> {e.resultPct||'-'}</div>
                </div>
                {e.feedback && <div className="mt-2 text-[13px] text-gray-700">{e.feedback}</div>}
                <div className="mt-3 flex gap-2">
                  <button className="chip" onClick={()=>onEdit(e.id)}>ìˆ˜ì •</button>
                  <button className="chip" style={{color:'#dc2626',borderColor:'#fecaca'}} onClick={()=>removeEntry(e.id)}>ì‚­ì œ</button>
                </div>
              </div>
            ))}
            {filtered.length===0 && <div className="text-center muted py-6 text-sm">ì•„ì§ ê¸°ë¡ì´ ì—†ì–´ìš”.</div>}
          </div>

          {/* ë°ìŠ¤í¬í†± í…Œì´ë¸” */}
          <div className="hidden md:block overflow-auto rounded-xl border border-[#eef2f7]">
            <table className="min-w-full text-sm">
              <thead className="bg-[#f8fafc]">
                <tr>
                  {['ë‚ ì§œ','ì‚¬ì´ë“œ','ìˆ˜ëŸ‰','ê°€ê²©','ì‹¤í˜„(%)','ì‹¤í˜„(â‚©)','ë³´ìœ ','ì˜í•œ ì ','í”¼ë“œë°±','ì‘ì—…'].map(h=><th key={h} className="px-3 py-2 text-left whitespace-nowrap">{h}</th>)}
                </tr>
              </thead>
              <tbody>
                {filtered.map(e=>(
                  <tr key={e.id} className="hover:bg-[#fafafa]">
                    <td className="px-3 py-2">{e.date}</td>
                    <td className="px-3 py-2">{e.side}</td>
                    <td className="px-3 py-2 text-right">{e.qty}</td>
                    <td className="px-3 py-2 text-right">{e.price}</td>
                    <td className="px-3 py-2 text-right">{e.resultPct}</td>
                    <td className={"px-3 py-2 text-right "+(Number(e.resultPnl||0)>=0? 'text-emerald-600':'text-rose-600')}>{e.resultPnl}</td>
                    <td className="px-3 py-2">{e.hold? 'ë³´ìœ ':'-'}</td>
                    <td className="px-3 py-2 max-w-[280px] truncate" title={e.good}>{e.good}</td>
                    <td className="px-3 py-2 max-w-[320px] truncate" title={e.feedback}>{e.feedback}</td>
                    <td className="px-3 py-2">
                      <div className="flex gap-2">
                        <button className="chip" onClick={()=>onEdit(e.id)}>ìˆ˜ì •</button>
                        <button className="chip" style={{color:'#dc2626',borderColor:'#fecaca'}} onClick={()=>removeEntry(e.id)}>ì‚­ì œ</button>
                      </div>
                    </td>
                  </tr>
                ))}
                {filtered.length===0 && (<tr><td colSpan="10" className="px-3 py-10 text-center muted">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>)}
              </tbody>
            </table>
          </div>
        </div>
      );
    }

    function App(){
      const [state, setState] = useLocalState(APP_KEY, defaultState);
      const [tab, setTab] = useState('dashboard');
      const [active, setActive] = useState(0); // 0: ì›”ë³„, 1: ìƒˆì¼ì§€, 2: ê°€ì´ë“œ
      const [stockTab, setStockTab] = useState(STOCKS[0].key);
      const [editing, setEditing] = useState(null);

      const realized = useMemo(()=> Object.keys(state.journals).flatMap(k=> state.journals[k]).filter(e=> !e.hold && Number(e.resultPnl||0)!==0), [state]);
      const totals = useMemo(()=>{
        const pnl = realized.reduce((s,e)=> s + Number(e.resultPnl||0), 0);
        const initialSeed = Number(state.settings?.initialSeed || 0);
        const currentSeed = initialSeed + pnl;
        const roi = initialSeed>0? (pnl/initialSeed)*100: 0;
        return {pnl, initialSeed, currentSeed, roi};
      }, [realized, state.settings]);
      const count = useMemo(()=> Object.values(state.journals).reduce((s,a)=> s+a.length, 0), [state]);

      const addEntry = (stock)=> setEditing({stock, entry: defaultJournal()});
      const saveEntry = ()=>{
        const {stock, entry} = editing;
        setState(prev=>{
          const exists = prev.journals[stock].some(e=> e.id===entry.id);
          const next = exists? prev.journals[stock].map(e=> e.id===entry.id? entry: e) : [entry, ...prev.journals[stock]];
          return {...prev, journals:{...prev.journals, [stock]: next}};
        });
        setEditing(null);
      };

      const setMonthly = (ym, v)=> setState(prev=> ({...prev, monthlyPnL:{...prev.monthlyPnL, [ym]: v}}));
      const setInitialSeed = v => setState(prev=> ({...prev, settings:{...prev.settings, initialSeed:v}}));

      const slides = [
        <Monthly key="m" state={state} setMonthly={setMonthly} />,
        <QuickAdd key="q" add={addEntry} />,
        <Guide key="g" />
      ];

      return (
        <AppCtx.Provider value={{totals, count}}>
          <div className="max-w-7xl mx-auto px-4 pb-24">
            {/* í—¤ë” */}
            <div className="flex items-center justify-between pt-6">
              <div>
                <div className="brand">stock tracker</div>
                <div className="muted text-xs mt-1">swing diary & monthly pnl Â· local only</div>
              </div>
              <div className="flex gap-2">
                <button className={"tab "+(tab==='dashboard'?'active':'')} onClick={()=>setTab('dashboard')}>ëŒ€ì‹œë³´ë“œ</button>
                <button className={"tab "+(tab==='journal'?'active':'')} onClick={()=>setTab('journal')}>ì¼ì§€</button>
                <button className={"tab "+(tab==='settings'?'active':'')} onClick={()=>setTab('settings')}>ì„¤ì •</button>
              </div>
            </div>

            {/* ëŒ€ì‹œë³´ë“œ ìºëŸ¬ì…€ */}
            {tab==='dashboard' && (
              <div className="relative mt-8 deck">
                {slides.map((el, i)=>(
                  <div key={i} className={"slide "+(active===i?'active':'')}>
                    {el}
                  </div>
                ))}
                <button className="nav-fab nav-left" aria-label="ì´ì „" onClick={()=>setActive((active+slides.length-1)%slides.length)}>&lt;</button>
                <button className="nav-fab nav-right" aria-label="ë‹¤ìŒ" onClick={()=>setActive((active+1)%slides.length)}>&gt;</button>
              </div>
            )}

            {/* ì¼ì§€ */}
            {tab==='journal' && <JournalPage state={state} setState={setState} stockTab={stockTab} setStockTab={setStockTab} onEdit={(id)=>{
              const e = state.journals[stockTab].find(x=>x.id===id);
              if(e) setEditing({stock:stockTab, entry:{...e}});
            }}/>}

            {/* ì„¤ì • */}
            {tab==='settings' && (
              <div className="grid md:grid-cols-2 gap-4 mt-8">
                <Section title="ì´ˆê¸° ì‹œë“œ">
                  <div className="flex items-center gap-2">
                    <input className="chip w-48 text-right" value={state.settings.initialSeed}
                      onChange={e=> setInitialSeed(Number(String(e.target.value).replace(/[^0-9]/g,'')||0))}/>
                    <span className="text-sm">ì›</span>
                  </div>
                </Section>

                <Section title="ë°±ì—…/ë³µì›">
                  <div className="flex flex-wrap gap-2">
                    <button className="chip" onClick={()=>{
                      const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
                      const url = URL.createObjectURL(blob);
                      const a = document.createElement('a');
                      a.href=url; a.download=`swing-tracker-backup-${Date.now()}.json`; a.click();
                      URL.revokeObjectURL(url);
                    }}>JSON ë°±ì—…</button>
                    <label className="chip cursor-pointer">ë³µì›
                      <input type="file" className="hidden" accept="application/json" onChange={e=>{
                        const f=e.target.files?.[0]; if(!f) return;
                        const r=new FileReader(); r.onload=()=>{ try{ setState(JSON.parse(r.result)); }catch{ alert('í˜•ì‹ ì˜¤ë¥˜'); } }; r.readAsText(f);
                      }}/>
                    </label>
                  </div>
                </Section>
              </div>
            )}

            <EditorSheet editing={editing} setEditing={setEditing} onSave={saveEntry}/>
          </div>
        </AppCtx.Provider>
      );
    }

    const root = document.getElementById('root');
    ReactDOM.createRoot(root).render(<App/>);
  </script>
</body>
</html>
