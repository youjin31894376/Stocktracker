<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>stock tracker · Holographic</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Pretendard -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css"/>

  <!-- React 18 -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    :root{
      --stroke: rgba(255,255,255,.55);
      --muted:#6b7280;
      --text:#0f172a;
      --shadow: 0 8px 20px rgba(15, 23, 42, .10);
      --shadow-soft: 0 6px 14px rgba(15, 23, 42, .08);
      --safe: env(safe-area-inset-bottom, 0px);
    }
    html,body{height:100%}
    body{
      font-family:"Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
      color:var(--text);
      /* holographic */
      background:
        radial-gradient(1000px 600px at 10% -10%, #bfe3ff 0%, transparent 60%),
        radial-gradient(900px 520px at 100% 20%, #ffe0f5 0%, transparent 55%),
        radial-gradient(700px 520px at 40% 110%, #d9ffef 0%, transparent 50%),
        linear-gradient(180deg, #f7fbff, #eef0ff 60%, #fff0fb);
    }
    .glass-card{
      background: linear-gradient(180deg, rgba(255,255,255,.68), rgba(255,255,255,.48));
      backdrop-filter: blur(16px) saturate(140%);
      -webkit-backdrop-filter: blur(16px) saturate(140%);
      border:1px solid var(--stroke);
      border-radius:18px;
      box-shadow: var(--shadow);
    }
    .muted{ color:var(--muted); }

    .glass-input,.glass-select,.glass-textarea{
      background: rgba(255,255,255,.7);
      border:1px solid rgba(255,255,255,.95);
      border-radius:12px;
      padding:10px 12px;
      outline:none; transition:.18s ease; box-shadow: var(--shadow-soft);
    }
    .glass-input:focus,.glass-select:focus,.glass-textarea:focus{
      box-shadow:0 0 0 4px rgba(59,130,246,.15);
      border-color:#cfe3ff;
    }
    .pill{
      border-radius:12px;
      background: linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.7));
      border:1px solid rgba(255,255,255,.92);
      padding:8px 12px; box-shadow: var(--shadow-soft);
    }

    .holo-btn{
      position:relative; border-radius:14px; padding:10px 16px; cursor:pointer;
      color:#0b1220; font-weight:600; border:1px solid transparent;
      background:
        linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.78)) padding-box,
        conic-gradient(from 160deg at 50% 50%, #7c3aed, #06b6d4, #22d3ee, #f472b6, #7c3aed) border-box;
      box-shadow:0 10px 22px rgba(15,23,42,.12), inset 0 1px 0 rgba(255,255,255,.7);
      transition:transform .15s ease;
    }
    .holo-btn:hover{ transform:translateY(-1px); }

    /* Carousel */
    .carousel{
      scroll-behavior:smooth;
      overflow-x:auto; display:flex; gap:22px; padding:8px 6px;
      align-items:center; min-height: 64vh;    /* 가운데 정렬 */
    }
    .carousel::-webkit-scrollbar{ display:none; }
    .carousel{ -ms-overflow-style:none; scrollbar-width:none; }

    /* Round glass nav */
    .nav-btn{
      position:absolute; top:50%; transform:translateY(-50%);
      width:46px; height:46px; z-index:20;               /* 클릭 잘 되게 */
      display:flex; align-items:center; justify-content:center;
      border-radius:9999px; cursor:pointer; user-select:none;
      background: linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.7));
      border:1px solid rgba(255,255,255,.95);
      backdrop-filter: blur(10px) saturate(160%);
      -webkit-backdrop-filter: blur(10px) saturate(160%);
      box-shadow: var(--shadow); color:#334155;
    }
    .nav-left{ left:-16px; }
    .nav-right{ right:-16px; }

    /* Equal card size */
    .deck-card{
      min-width:360px; width:360px; height:520px;      /* 크기 통일 */
      display:flex; flex-direction:column;
    }

    /* stat */
    .stat .label{ font-size:12px; color:var(--muted); }
    .stat .value{
      font-weight:600; font-size:16px;                 /* 숫자 안 잘림 */
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    /* bottom sheet (editor) */
    .sheet{
      position:fixed; left:0; right:0; bottom:0; z-index:50;
      background:#fff; border-top-left-radius:16px; border-top-right-radius:16px;
      box-shadow:0 -12px 28px rgba(15,23,42,.18);
      transform:translateY(100%); transition:transform .25s ease;
      padding-bottom:calc(12px + var(--safe));
    }
    .sheet.open{ transform:translateY(0%); }
    .sheet-handle{ width:44px; height:5px; border-radius:9999px; background:#e5e7eb; margin:8px auto 6px; }
  </style>
</head>
<body>
  <div id="root" class="min-h-screen"></div>

  <script type="text/babel">
    const {useState,useMemo,useEffect,useRef} = React;

    const APP_KEY = "swing-home-v4";
    const STOCKS = [
      { key:'kakao', name:'카카오' },
      { key:'samsung', name:'삼성전자' },
      { key:'sm', name:'에스엠' },
    ];

    /* ---------- util ---------- */
    const currency = n => Number(n||0).toLocaleString();

    /* ---------- local state ---------- */
    function useLocalState(key, initial){
      const [state, setState] = useState(()=>{
        try{
          const raw = localStorage.getItem(key);
          return raw? JSON.parse(raw) : initial;
        }catch(e){ return initial; }
      });
      useEffect(()=>{
        try{ localStorage.setItem(key, JSON.stringify(state)); }catch(e){}
      }, [key, state]);
      return [state, setState];
    }

    /* ---------- data model ---------- */
    const defaultEntry = () => ({
      id: (crypto?.randomUUID?.() || String(Date.now()+Math.random())),
      date: new Date().toISOString().slice(0,10),
      side: '매수',
      qty:'', price:'',
      resultPct:'', resultPnl:'',
      good:'', feedback:'',
      hold:false, tags:'스윙'
    });

    const defaultState = {
      settings: { initialSeed: 16000000 },
      monthlyPnL: {},                        // 'YYYY-MM' : '금액'
      journals: { kakao:[], samsung:[], sm:[] }
    };

    /* ---------- UI ---------- */
    const Section = ({title, right, children, className=""}) => (
      <div className={"glass-card p-4 md:p-5 deck-card " + className}>
        <div className="flex items-center justify-between mb-3">
          <div className="font-semibold text-[15px] text-slate-800">{title}</div>
          <div className="flex items-center gap-2">{right}</div>
        </div>
        <div className="flex-1 overflow-auto pr-1">{children}</div>
      </div>
    );

    const Stat = ({label, value}) => (
      <div className="glass-card p-3 stat">
        <div className="label">{label}</div>
        <div className="value">{value}</div>
      </div>
    );

    function MonthlyPnLTable({ monthly, onChange }){
      const [year, setYear] = useState(new Date().getFullYear());
      const months = Array.from({length:12}, (_,i)=>i+1);
      const ym = (y,m)=> `${y}-${String(m).padStart(2,'0')}`;
      const [editing, setEditing] = useState(false);

      return (
        <div className="flex flex-col h-full">
          <div className="flex items-center justify-between mb-2">
            <div className="flex items-center gap-2">
              <span className="text-xs muted">연도</span>
              <select className="glass-select text-[13px] py-[6px]" value={year} onChange={e=>setYear(Number(e.target.value))}>
                {Array.from({length:6},(_,i)=>new Date().getFullYear()-3+i).map(y=>(
                  <option key={y} value={y}>{y}</option>
                ))}
              </select>
            </div>
            <button className="pill text-[13px]" onClick={()=>setEditing(v=>!v)}>{editing? '완료':'편집'}</button>
          </div>

          <div className="grid grid-cols-2 gap-3">
            {months.map(m=>{
              const key = ym(year, m);
              const v = monthly[key] ?? '';
              return (
                <div key={key} className="glass-card p-2">
                  <div className="text-xs muted mb-1">{m}월</div> {/* ← n월만 표기 */}
                  <input
                    className="glass-input w-full text-right"
                    placeholder="예: 140000"
                    value={v}
                    disabled={!editing}
                    onChange={e=>onChange(key, e.target.value)}
                  />
                </div>
              )
            })}
          </div>

          <div className="grid grid-cols-2 gap-3 md:grid-cols-4 mt-3">
            <Stat label="월 합계" value={`${currency(Object.values(monthly).reduce((s,v)=>s+Number(v||0),0))} 원`}/>
            <Stat label="현재 시드" value={`${currency(/* 추후 합산 가능 */ Number(16000000))} 원`}/>
            <Stat label="수익률" value={`0.0 %`}/>
            <Stat label="총 일지 수" value={`0 건`}/>
          </div>
        </div>
      );
    }

    function EditorSheet({ editing, setEditing, onSave }){
      if(!editing) return null;
      const { entry, stock } = editing;
      const update = (k,v)=> setEditing(p=> ({...p, entry:{...p.entry, [k]:v}}));

      return (
        <div className="sheet open">
          <div className="sheet-handle"></div>
          <div className="px-4 pt-1 pb-4">
            <div className="flex items-center justify-between mb-2">
              <div className="text-sm muted">일지 입력 · {stock}</div>
              <button className="pill" onClick={()=>setEditing(null)}>닫기</button>
            </div>

            <div className="grid grid-cols-2 gap-3">
              <div>
                <div className="text-xs muted mb-1">날짜</div>
                <input type="date" className="glass-input w-full" value={entry.date} onChange={e=>update('date', e.target.value)}/>
              </div>
              <div>
                <div className="text-xs muted mb-1">사이드</div>
                <select className="glass-input w-full" value={entry.side} onChange={e=>update('side', e.target.value)}>
                  <option>매수</option><option>매도</option><option>관망</option><option>청산</option>
                </select>
              </div>

              <div>
                <div className="text-xs muted mb-1">수량</div>
                <input className="glass-input w-full" value={entry.qty} onChange={e=>update('qty', e.target.value)} />
              </div>
              <div>
                <div className="text-xs muted mb-1">가격</div>
                <input className="glass-input w-full" value={entry.price} onChange={e=>update('price', e.target.value)} />
              </div>

              <div>
                <div className="text-xs muted mb-1">실현 수익률(%)</div>
                <input className="glass-input w-full" value={entry.resultPct} onChange={e=>update('resultPct', e.target.value)} />
              </div>
              <div>
                <div className="text-xs muted mb-1">실현 손익(₩)</div>
                <input className="glass-input w-full" value={entry.resultPnl} onChange={e=>update('resultPnl', e.target.value)} />
              </div>

              <div className="col-span-2">
                <div className="text-xs muted mb-1">잘한 점</div>
                <textarea rows="2" className="glass-textarea w-full" value={entry.good} onChange={e=>update('good', e.target.value)}></textarea>
              </div>

              <div className="col-span-2">
                <div className="text-xs muted mb-1">피드백</div>
                <textarea rows="3" className="glass-textarea w-full" value={entry.feedback} onChange={e=>update('feedback', e.target.value)}></textarea>
              </div>

              <div>
                <div className="text-xs muted mb-1">보유</div>
                <select className="glass-input w-full" value={entry.hold?'Y':'N'} onChange={e=>update('hold', e.target.value==='Y')}>
                  <option value="N">아니오</option><option value="Y">예</option>
                </select>
              </div>
              <div>
                <div className="text-xs muted mb-1">태그</div>
                <input className="glass-input w-full" value={entry.tags} onChange={e=>update('tags', e.target.value)} />
              </div>
            </div>

            <div className="pt-3">
              <button className="holo-btn w-full" onClick={onSave}>저장</button>
            </div>
          </div>
        </div>
      )
    }

    /* ---------- App ---------- */
    function App(){
      const [state, setState] = useLocalState(APP_KEY, defaultState);
      const [tab, setTab] = useState('dashboard');
      const [editing, setEditing] = useState(null);

      const carouselRef = useRef(null);
      const scrollByCard = (dir)=>{
        const el = carouselRef.current;
        if(!el) return;
        const cardW = el.querySelector('.deck-card')?.getBoundingClientRect().width || 360;
        el.scrollBy({ left: dir*(cardW+22), behavior:'smooth' });
      };

      const openNew = (stock)=> setEditing({ stock, entry: defaultEntry() });
      const saveEntry = ()=>{
        const { stock, entry } = editing;
        setState(prev=>{
          const next = [entry, ...prev.journals[stock]];
          return { ...prev, journals:{ ...prev.journals, [stock]: next } };
        });
        setEditing(null);
        alert('저장했어요!');
      };

      const setMonthly = (ym, value)=> setState(prev=>({
        ...prev, monthlyPnL: { ...prev.monthlyPnL, [ym]: value }
      }));

      return (
        <div className="min-h-screen">
          {/* Header */}
          <header className="max-w-7xl mx-auto px-5 pt-8 pb-6">
            <div className="flex items-center justify-between">
              <div>
                <h1 className="text-2xl md:text-3xl font-semibold tracking-tight">stock tracker</h1>
                <p className="muted text-sm">swing diary & monthly pnl · local only</p>
              </div>
              <div className="flex gap-2">
                <button className={"pill " + (tab==='dashboard'?'ring-2 ring-blue-200':'')} onClick={()=>setTab('dashboard')}>대시보드</button>
                <button className={"pill " + (tab==='settings'?'ring-2 ring-blue-200':'')} onClick={()=>setTab('settings')}>설정</button>
              </div>
            </div>
          </header>

          {/* Dashboard */}
          {tab==='dashboard' && (
            <main className="relative">
              <div className="max-w-7xl mx-auto px-5">
                <div className="relative">
                  {/* nav buttons */}
                  <button className="nav-btn nav-left hidden md:flex" aria-label="left" onClick={()=>scrollByCard(-1)}>&lt;</button>
                  <button className="nav-btn nav-right hidden md:flex" aria-label="right" onClick={()=>scrollByCard(1)}>&gt;</button>

                  <div className="carousel" ref={carouselRef}>
                    {/* 월별 실현 손익 */}
                    <Section title="월별 실현 손익">
                      <MonthlyPnLTable monthly={state.monthlyPnL} onChange={setMonthly}/>
                    </Section>

                    {/* 새 일지 */}
                    <Section title="새 일지">
                      <div className="flex flex-wrap gap-2">
                        <button className="holo-btn" onClick={()=>openNew('kakao')}>카카오</button>
                        <button className="holo-btn" onClick={()=>openNew('samsung')}>삼성전자</button>
                        <button className="holo-btn" onClick={()=>openNew('sm')}>에스엠</button>
                      </div>
                      <p className="muted text-xs mt-3">버튼을 눌러 바로 일지 시트를 열 수 있어요.</p>
                    </Section>

                    {/* 가이드 */}
                    <Section title="가이드">
                      <ul className="list-disc pl-5 text-sm muted space-y-1">
                        <li>월별 금액은 <b>편집</b>을 눌러 입력해 두면 저장돼요.</li>
                        <li>좌우 <b>&lt;</b>, <b>&gt;</b> 유리 버튼으로 카드 이동.</li>
                        <li>일지는 ‘잘한 점/피드백’으로 나눠 기록합니다.</li>
                        <li>모든 데이터는 이 기기에만 저장됩니다.</li>
                      </ul>
                    </Section>
                  </div>
                </div>
              </div>
            </main>
          )}

          {/* Settings */}
          {tab==='settings' && (
            <main className="max-w-5xl mx-auto px-5 pb-16">
              <div className="glass-card p-5 max-w-xl">
                <div className="font-semibold mb-3">초기 시드</div>
                <div className="flex items-center gap-2">
                  <input
                    className="glass-input w-56 text-right"
                    value={state.settings.initialSeed}
                    onChange={(e)=>{
                      const v = Number(String(e.target.value).replace(/[^0-9]/g,'')||0);
                      setState(prev=>({...prev, settings:{...prev.settings, initialSeed:v}}));
                    }}
                  />
                  <span className="text-sm">원</span>
                </div>
              </div>
            </main>
          )}

          {/* Editor Sheet */}
          <EditorSheet editing={editing} setEditing={setEditing} onSave={saveEntry}/>

          <footer className="pb-[calc(20px+var(--safe))]"></footer>
        </div>
      )
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>