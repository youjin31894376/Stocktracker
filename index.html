<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>stock tracker · Holographic</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Pretendard -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css"/>

  <!-- React 18 -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    :root{
      --bg-a:#f7fbff;
      --bg-b:#eef0ff;
      --bg-c:#fff0fb;
      --stroke: rgba(255,255,255,.55);
      --muted:#6b7280;
      --text:#0f172a;
      --glass: rgba(255,255,255,.45);
      --shadow: 0 6px 18px rgba(30, 41, 59, .10); /* 좁고 깔끔한 그림자 */
      --shadow-soft: 0 4px 10px rgba(30, 41, 59, .08);
      --safe: env(safe-area-inset-bottom, 0px);
    }

    html,body{height:100%}
    body{
      font-family:"Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
      color:var(--text);
      /* Holographic bg */
      background:
        radial-gradient(1000px 600px at 10% -10%, #bfe3ff 0%, transparent 60%),
        radial-gradient(900px 520px at 100% 20%, #ffe0f5 0%, transparent 55%),
        radial-gradient(700px 520px at 40% 110%, #d9ffef 0%, transparent 50%),
        linear-gradient(180deg, var(--bg-a), var(--bg-b) 60%, var(--bg-c));
    }

    /* Glass card */
    .glass-card{
      background: linear-gradient(180deg, rgba(255,255,255,.65), rgba(255,255,255,.45));
      backdrop-filter: blur(16px) saturate(140%);
      -webkit-backdrop-filter: blur(16px) saturate(140%);
      border: 1px solid var(--stroke);
      border-radius: 18px;
      box-shadow: var(--shadow);
    }

    .section-title{
      font-weight:600;
      font-size:1rem;
      color:#1e293b;
    }

    .muted{ color: var(--muted); }

    .glass-input,.glass-select{
      background: rgba(255,255,255,.6);
      border:1px solid rgba(255,255,255,.9);
      border-radius:12px;
      padding:10px 12px;
      outline:none;
      transition:.18s ease;
      box-shadow: var(--shadow-soft);
    }
    .glass-input:focus,.glass-select:focus{
      box-shadow:0 0 0 4px rgba(59,130,246,.15);
      border-color:#cfe3ff;
    }

    /* holo button */
    .holo-btn{
      position:relative; border-radius:14px; padding:10px 14px; cursor:pointer;
      color:#0b1220; font-weight:600; border:1px solid transparent;
      background:
        linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.75)) padding-box,
        conic-gradient(from 160deg at 50% 50%, #7c3aed, #06b6d4, #22d3ee, #f472b6, #7c3aed) border-box;
      box-shadow:0 10px 22px rgba(15,23,42,.12), inset 0 1px 0 rgba(255,255,255,.7);
      transition:transform .15s ease;
    }
    .holo-btn:hover{ transform:translateY(-1px); }

    /* Carousel */
    .carousel{
      scroll-behavior:smooth;
      overflow-x:auto;
      display:flex; gap:20px;
      padding:8px 4px 8px 4px;
    }
    .carousel::-webkit-scrollbar{ display:none; }
    .carousel{ -ms-overflow-style:none; scrollbar-width:none; }

    /* Round glass nav buttons */
    .nav-btn{
      position:absolute; top:50%; transform:translateY(-50%);
      width:44px; height:44px; display:flex; align-items:center; justify-content:center;
      border-radius:9999px; cursor:pointer; user-select:none;
      background: linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.65));
      border:1px solid rgba(255,255,255,.9);
      backdrop-filter: blur(10px) saturate(160%);
      -webkit-backdrop-filter: blur(10px) saturate(160%);
      box-shadow: var(--shadow);
      color:#475569;
    }
    .nav-left{ left:-16px; }
    .nav-right{ right:-16px; }

    /* compact stat */
    .stat{
      min-width:0;
    }
    .stat .value{
      font-weight:600;
      font-size:18px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;  /* 넘침 방지 */
    }
    .pill{
      border-radius:12px;
      background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.7));
      border:1px solid rgba(255,255,255,.9);
      padding:8px 12px;
      box-shadow: var(--shadow-soft);
    }
  </style>
</head>
<body>
  <div id="root" class="min-h-screen"></div>

  <script type="text/babel">
    const {useState,useMemo,useEffect,useRef} = React;

    const APP_KEY = "swing-home-v3";
    const STOCKS = [
      { key:'kakao', name:'카카오' },
      { key:'samsung', name:'삼성전자' },
      { key:'sm', name:'에스엠' },
    ];

    /* ---------- util ---------- */
    const currency = n => Number(n||0).toLocaleString();

    /* ---------- state (localStorage) ---------- */
    function useLocalState(key, initial){
      const [state, setState] = useState(()=>{
        try{
          const raw = localStorage.getItem(key);
          return raw? JSON.parse(raw) : initial;
        }catch(e){ return initial; }
      });
      useEffect(()=>{
        try{ localStorage.setItem(key, JSON.stringify(state)); }catch(e){}
      }, [key, state]);
      return [state, setState];
    }

    const defaultState = {
      settings: { initialSeed: 16000000 },
      monthlyPnL: {},                        // 'YYYY-MM' : '금액'
      journals: { kakao:[], samsung:[], sm:[] }
    };

    /* ---------- components ---------- */
    const Section = ({title, right, children, className=""}) => (
      <div className={"glass-card p-4 md:p-5 " + className}>
        <div className="flex items-center justify-between mb-3">
          <div className="section-title">{title}</div>
          <div className="flex items-center gap-2">{right}</div>
        </div>
        {children}
      </div>
    );

    const Stat = ({label, value}) => (
      <div className="glass-card p-3 stat">
        <div className="text-xs muted">{label}</div>
        <div className="value">{value}</div>
      </div>
    );

    function MonthlyPnLTable({ monthly, onChange }){
      const [year, setYear] = useState(new Date().getFullYear());
      const months = Array.from({length:12}, (_,i)=>i+1);
      const ym = (y,m)=> `${y}-${String(m).padStart(2,'0')}`;
      const [editing, setEditing] = useState(false);

      return (
        <div>
          <div className="flex items-center justify-between mb-2">
            <div className="flex items-center gap-2">
              <span className="text-xs muted">연도</span>
              <select className="glass-select" value={year} onChange={e=>setYear(Number(e.target.value))}>
                {Array.from({length:6},(_,i)=>new Date().getFullYear()-3+i).map(y=>(
                  <option key={y} value={y}>{y}</option>
                ))}
              </select>
            </div>
            <button className="pill text-sm" onClick={()=>setEditing(v=>!v)}>{editing? '완료':'편집'}</button>
          </div>

          <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
            {months.map(m=>{
              const key = ym(year, m);
              const v = monthly[key] ?? '';
              return (
                <div key={key} className="glass-card p-2">
                  <div className="text-xs muted mb-1">{year}년 {m}월</div>
                  <input
                    className="glass-input w-full text-right"
                    placeholder="예: 140000"
                    value={v}
                    disabled={!editing}
                    onChange={e=>onChange(key, e.target.value)}
                  />
                </div>
              )
            })}
          </div>
        </div>
      );
    }

    /* ---------- Main App ---------- */
    function App(){
      const [state, setState] = useLocalState(APP_KEY, defaultState);
      const [tab, setTab] = useState('dashboard');

      // totals
      const totals = useMemo(()=>{
        const monthlyTotal = Object.values(state.monthlyPnL).reduce((s,v)=>s+Number(v||0),0);
        const initialSeed = Number(state.settings.initialSeed||0);
        const currentSeed = initialSeed; // (일지 기반 실현 손익 합산 로직을 붙일 수 있음)
        return { monthlyTotal, currentSeed };
      }, [state]);

      const setMonthly = (ym, value)=> setState(prev=>({
        ...prev, monthlyPnL: { ...prev.monthlyPnL, [ym]: value }
      }));

      const carouselRef = useRef(null);
      const scrollByCard = (dir)=>{
        const el = carouselRef.current;
        if(!el) return;
        const cardWidth = el.querySelector('.glass-card')?.getBoundingClientRect().width || 360;
        el.scrollBy({ left: dir* (cardWidth+20), behavior:'smooth' });
      };

      return (
        <div className="min-h-screen">
          {/* Header */}
          <header className="max-w-7xl mx-auto px-5 pt-8 pb-6">
            <div className="flex items-center justify-between">
              <div>
                <h1 className="text-2xl md:text-3xl font-semibold tracking-tight">stock tracker</h1>
                <p className="muted text-sm">swing diary & monthly pnl · local only</p>
              </div>
              <div className="flex gap-2">
                <button className={"pill " + (tab==='dashboard'?'ring-2 ring-blue-200':'')} onClick={()=>setTab('dashboard')}>대시보드</button>
                <button className={"pill " + (tab==='settings'?'ring-2 ring-blue-200':'')} onClick={()=>setTab('settings')}>설정</button>
              </div>
            </div>
          </header>

          {/* Body: 세로 가운데 정렬 + 가로 캐러셀 */}
          {tab==='dashboard' && (
            <main className="relative">
              <div className="max-w-7xl mx-auto px-5">
                <div className="relative">
                  {/* nav buttons */}
                  <button className="nav-btn nav-left hidden md:flex" aria-label="left" onClick={()=>scrollByCard(-1)}>&lt;</button>
                  <button className="nav-btn nav-right hidden md:flex" aria-label="right" onClick={()=>scrollByCard(1)}>&gt;</button>

                  <div className="carousel md:py-8" ref={carouselRef} style={{alignItems:'center', minHeight:'62vh'}}>
                    {/* 월별 실현 손익 */}
                    <Section title="월별 실현 손익" className="min-w-[320px] w-[360px]">
                      <MonthlyPnLTable monthly={state.monthlyPnL} onChange={setMonthly}/>
                      <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mt-4">
                        <Stat label="월 합계" value={`${currency(totals.monthlyTotal)} 원`}/>
                        <Stat label="현재 시드" value={`${currency(totals.currentSeed)} 원`}/>
                        <Stat label="수익률" value={`0.0 %`}/>
                        <Stat label="총 일지 수" value={`0 건`}/>
                      </div>
                    </Section>

                    {/* 새 일지 (버튼만 – 요청 라벨 변경) */}
                    <Section title="새 일지" className="min-w-[320px] w-[360px]">
                      <div className="flex flex-wrap gap-2">
                        {STOCKS.map(s=>(
                          <button key={s.key} className="holo-btn">{s.name}</button>
                        ))}
                      </div>
                      <p className="muted text-xs mt-3">* 실제 일지 작성은 추후 카드에서 열리도록 연결할 수 있어요.</p>
                    </Section>

                    {/* 가이드 */}
                    <Section title="가이드" className="min-w-[320px] w-[360px]">
                      <ul className="list-disc pl-5 text-sm muted space-y-1">
                        <li>월별 금액은 <b>편집</b>을 눌러 한 번 입력해 두면 저장돼요.</li>
                        <li>버튼은 유리 느낌으로, 좌우 &lt; / &gt;로 카드 이동해요.</li>
                        <li>데이터는 이 기기에만 저장됩니다.</li>
                      </ul>
                    </Section>
                  </div>
                </div>
              </div>
            </main>
          )}

          {tab==='settings' && (
            <main className="max-w-5xl mx-auto px-5 pb-16">
              <Section title="초기 시드">
                <div className="flex items-center gap-2">
                  <input
                    className="glass-input w-52 text-right"
                    value={state.settings.initialSeed}
                    onChange={(e)=>{
                      const v = Number(String(e.target.value).replace(/[^0-9]/g,'')||0);
                      setState(prev=>({...prev, settings:{...prev.settings, initialSeed:v}}));
                    }}
                  />
                  <span className="text-sm">원</span>
                </div>
              </Section>
            </main>
          )}

          <footer className="pb-[calc(20px+var(--safe))]"></footer>
        </div>
      )
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>