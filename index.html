<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>개인용 스윙 트래커 홈 · Holographic (Mobile)</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Pretendard -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css"
    />

    <!-- React 18 + Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- ✅ Firebase (compat 버전: 브라우저 전역 firebase.* 로 사용) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
      :root {
        --bg: #ffffff;
        --text: #111827;
        --muted: #6b7280;
        --shadow: 0 6px 20px rgba(0, 0, 0, 0.06);
        --stroke: #e5e7eb;
        --safe: env(safe-area-inset-bottom, 0px);
      }
      html, body { height: 100%; }
      body {
        font-family: "Pretendard Variable", Pretendard, -apple-system,
          BlinkMacSystemFont, "Segoe UI", Roboto, "Apple SD Gothic Neo",
          "Malgun Gothic", sans-serif;
        background: var(--bg);
        color: var(--text);
        font-size: 0.9rem;
      }
      .glass-card { background:#fff; border:1px solid var(--stroke); border-radius:12px; box-shadow:var(--shadow); }
      .glass-input,.glass-select,.glass-textarea{
        background:#f9fafb; border:1px solid #e5e7eb; color:var(--text); border-radius:10px; transition:.2s ease; font-size:16px;
      }
      .glass-input:focus,.glass-select:focus,.glass-textarea:focus{ outline:none; border-color:#93c5fd; box-shadow:0 0 0 3px rgba(147,197,253,.3); }
      .holo-btn{
        position:relative;border-radius:12px;padding:10px 14px;color:#0b1220;font-weight:400;cursor:pointer;border:1px solid transparent;
        background:linear-gradient(180deg,rgba(255,255,255,.95),rgba(255,255,255,.7)) padding-box,
          conic-gradient(from 180deg at 50% 50%,#7c3aed,#06b6d4,#22d3ee,#f472b6,#7c3aed) border-box;
        box-shadow:0 10px 24px rgba(0,0,0,.08), inset 0 1px 0 rgba(255,255,255,.7);
        transition:transform .15s ease, box-shadow .2s ease, background .3s ease;
      }
      .holo-btn:hover{ transform:translateY(-1px); }
      .holo-btn:active{ transform:translateY(1px); box-shadow:0 6px 16px rgba(0,0,0,.12), inset 0 1px 0 rgba(255,255,255,.8); }
      .holo-btn::after{
        content:""; position:absolute; inset:0; border-radius:12px;
        background:linear-gradient(120deg,rgba(255,255,255,.8),rgba(255,255,255,0) 42%);
        transform:translateY(-60%); filter:blur(6px); opacity:.35; pointer-events:none;
      }
      .glass-btn{ border-radius:12px; padding:10px 12px; cursor:pointer; background:#f3f4f6; border:1px solid #e5e7eb; color:var(--text); font-size:.9rem; font-weight:400; transition:.2s ease; }
      .glass-btn:hover{ transform:translateY(-1px); }
      .danger{ color:#dc2626; border-color:#fecaca; }
      table thead{ color:#374151; font-weight:400; }
      table tbody{ color:#111827; }
      .table-cell{ border-top:1px solid #f1f5f9; }
      .muted{ color:var(--muted); }

      /* 바텀시트 */
      .sheet{ position:fixed; left:0; right:0; bottom:0; z-index:50; background:#fff;
        border-top-left-radius:16px; border-top-right-radius:16px; box-shadow:0 -10px 30px rgba(0,0,0,.12);
        transform:translateY(100%); transition:transform .25s ease; padding-bottom:calc(12px + var(--safe)); }
      .sheet.open{ transform:translateY(0%); }
      .sheet-handle{ width:40px; height:4px; border-radius:9999px; background:#e5e7eb; margin:8px auto 4px; }
      .fab{ position:fixed; right:16px; bottom:calc(16px + var(--safe)); z-index:40; }
      .meta-label{ font-size:12px; color:#6b7280; }
    </style>
  </head>

  <body class="min-h-screen">
    <div id="root" class="min-h-screen"></div>

    <script type="text/babel">
      const { useState, useMemo, useEffect } = React;

      /* =========================
         Firebase 초기화 (compat)
      ==========================*/
      const firebaseConfig = {
        apiKey: "AIzaSyBmyHCDjElHWFruKUz1psMF_JlR8xXkdsc",
        authDomain: "stock-tracker-c5203.firebaseapp.com",
        projectId: "stock-tracker-c5203",
        storageBucket: "stock-tracker-c5203.firebasestorage.app",
        messagingSenderId: "653038109673",
        appId: "1:653038109673:web:cc17abb3796a6d4dff0178",
        measurementId: "G-JCT2JK3PP6"
      };
      if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db   = firebase.firestore();

      // 익명 로그인(최초 로딩 시 자동)
      const userReady = new Promise((resolve) => {
        auth.onAuthStateChanged(async (u) => {
          if (u) return resolve(u);
          try { await auth.signInAnonymously(); } catch(e){}
        });
        // 로그인 완료 콜백에서 resolve됨
        auth.onAuthStateChanged((u)=> u && resolve(u));
      });

      /* ============ 기존 앱 상태 ============ */
      const APP_KEY = "swing-home-v2-mobile";
      const STOCKS = [
        { key: "kakao", name: "카카오" },
        { key: "samsung", name: "삼성전자" },
        { key: "sm", name: "에스엠" },
      ];

      const defaultJournalEntry = () => ({
        id: (crypto && crypto.randomUUID ? crypto.randomUUID() : String(Date.now()+Math.random())),
        date: new Date().toISOString().slice(0, 10),
        side: "매수", qty:"", price:"", fees:"",
        plan:"", reason:"", target:"1% 절반 익절, 3~5% 연장", stop:"최대 -2%",
        emotion:3, outcome:"진행중", resultPct:"", resultPnl:"", hold:false,
        tags:"스윙", notes:""
      });

      const defaultState = {
        settings: { initialSeed: 16000000 },
        monthlyPnL: {},
        journals: { kakao: [], samsung: [], sm: [] },
      };

      function useLocalState(key, initial){
        const [state, setState] = React.useState(() => {
          try {
            const hash = new URLSearchParams(location.hash.replace(/^#/, "")).get("data");
            if (hash) return JSON.parse(atob(hash));
          } catch(e){}
          try {
            const raw = localStorage.getItem(key);
            return raw? JSON.parse(raw): initial;
          } catch(e){ return initial; }
        });
        useEffect(()=>{ try{ localStorage.setItem(key, JSON.stringify(state)); }catch(e){} }, [key, state]);
        return [state, setState];
      }

      const currency = (n)=> Number(n||0).toLocaleString();
      const pct = (n)=> isFinite(n)? (Math.round(n*10)/10).toFixed(1): "0.0";

      const Section = ({title, right, children}) => (
        <div className="glass-card p-4">
          <div className="flex items-center justify-between mb-3">
            <h3 className="text-base font-normal">{title}</h3>
            <div className="flex items-center gap-2">{right}</div>
          </div>
          {children}
        </div>
      );

      const Stat = ({label, value, sub}) => (
        <div className="glass-card p-3">
          <div className="text-xs muted">{label}</div>
          <div className="text-lg font-normal">{value}</div>
          {sub && <div className="text-xs muted mt-1">{sub}</div>}
        </div>
      );

      function MonthlyPnLTable({ monthly, onChange }){
        const [year, setYear] = React.useState(new Date().getFullYear());
        const months = Array.from({length:12}, (_,i)=>i+1);
        const ym = (y,m)=> `${y}-${String(m).padStart(2,"0")}`;
        return (
          <div>
            <div className="flex items-center gap-2 mb-2">
              <span className="text-xs muted">연도</span>
              <select className="glass-select px-2 py-1" value={year} onChange={e=>setYear(Number(e.target.value))}>
                {Array.from({length:6},(_,i)=>new Date().getFullYear()-3+i).map(y=> <option key={y} value={y}>{y}</option>)}
              </select>
            </div>
            <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
              {months.map(m=>{
                const key = ym(year, m);
                const v = monthly[key] ?? "";
                return (
                  <div key={key} className="glass-card p-2">
                    <div className="text-xs muted mb-1">{year}년 {m}월</div>
                    <input
                      className="glass-input w-full px-3 py-2 text-right"
                      placeholder="예: 140000"
                      value={v}
                      onChange={e=>onChange(key, e.target.value)}
                    />
                  </div>
                );
              })}
            </div>
          </div>
        );
      }

      function EditorSheet({ editing, setEditing, onSave }){
        if(!editing) return null;
        const { entry, stock } = editing;
        const update = (k,v)=> setEditing(p=> ({...p, entry:{...p.entry, [k]:v}}));
        return (
          <div className="sheet open">
            <div className="sheet-handle"></div>
            <div className="px-4 pt-2 pb-3">
              <div className="flex items-center justify-between">
                <div className="text-sm muted">일지 입력 · {stock}</div>
                <button className="glass-btn" onClick={()=>setEditing(null)}>닫기</button>
              </div>
              <div className="grid grid-cols-2 gap-3 mt-3">
                <div className="col-span-1">
                  <div className="text-xs muted mb-1">날짜</div>
                  <input type="date" className="glass-input w/full px-3 py-2" value={entry.date} onChange={e=>update("date", e.target.value)}/>
                </div>
                <div className="col-span-1">
                  <div className="text-xs muted mb-1">사이드</div>
                  <select className="glass-input w-full px-3 py-2" value={entry.side} onChange={e=>update("side", e.target.value)}>
                    <option>매수</option><option>매도</option><option>관망</option><option>청산</option>
                  </select>
                </div>
                <div>
                  <div className="text-xs muted mb-1">수량</div>
                  <input inputMode="numeric" pattern="[0-9]*" className="glass-input w-full px-3 py-2" value={entry.qty} onChange={e=>update("qty", e.target.value)}/>
                </div>
                <div>
                  <div className="text-xs muted mb-1">가격</div>
                  <input inputMode="decimal" className="glass-input w-full px-3 py-2" value={entry.price} onChange={e=>update("price", e.target.value)}/>
                </div>
                <div>
                  <div className="text-xs muted mb-1">수수료/세금</div>
                  <input inputMode="decimal" className="glass-input w-full px-3 py-2" value={entry.fees} onChange={e=>update("fees", e.target.value)}/>
                </div>
                <div>
                  <div className="text-xs muted mb-1">감정(1~5)</div>
                  <input type="number" min="1" max="5" className="glass-input w-full px-3 py-2" value={entry.emotion} onChange={e=>update("emotion", e.target.value)}/>
                </div>
                <div className="col-span-2">
                  <div className="text-xs muted mb-1">부분익절/목표</div>
                  <input className="glass-input w-full px-3 py-2" value={entry.target} onChange={e=>update("target", e.target.value)}/>
                </div>
                <div className="col-span-2">
                  <div className="text-xs muted mb-1">리스크/손절</div>
                  <input className="glass-input w-full px-3 py-2" value={entry.stop} onChange={e=>update("stop", e.target.value)}/>
                </div>
                <div className="col-span-2">
                  <div className="text-xs muted mb-1">진입 계획(시나리오)</div>
                  <textarea rows="2" className="glass-input w-full px-3 py-2" value={entry.plan} onChange={e=>update("plan", e.target.value)}></textarea>
                </div>
                <div className="col-span-2">
                  <div className="text-xs muted mb-1">실행/종료 이유</div>
                  <textarea rows="2" className="glass-input w-full px-3 py-2" value={entry.reason} onChange={e=>update("reason", e.target.value)}></textarea>
                </div>
                <div>
                  <div className="text-xs muted mb-1">실현 수익률(%)</div>
                  <input inputMode="decimal" className="glass-input w-full px-3 py-2" value={entry.resultPct} onChange={e=>update("resultPct", e.target.value)}/>
                </div>
                <div>
                  <div className="text-xs muted mb-1">실현 손익(₩)</div>
                  <input inputMode="decimal" className="glass-input w-full px-3 py-2" value={entry.resultPnl} onChange={e=>update("resultPnl", e.target.value)}/>
                </div>
                <div>
                  <div className="text-xs muted mb-1">보유</div>
                  <select className="glass-input w-full px-3 py-2" value={entry.hold? "Y":"N"} onChange={e=>update("hold", e.target.value==="Y")}>
                    <option value="N">아니오</option><option value="Y">예</option>
                  </select>
                </div>
                <div>
                  <div className="text-xs muted mb-1">태그</div>
                  <input className="glass-input w-full px-3 py-2" value={entry.tags} onChange={e=>update("tags", e.target.value)}/>
                </div>
                <div className="col-span-2">
                  <div className="text-xs muted mb-1">메모</div>
                  <textarea rows="2" className="glass-input w-full px-3 py-2" value={entry.notes} onChange={e=>update("notes", e.target.value)}></textarea>
                </div>
              </div>
              <div className="sticky bottom-0 bg-white pt-3 mt-3">
                <div className="flex gap-2">
                  <button className="glass-btn flex-1" onClick={()=>setEditing(null)}>취소</button>
                  <button className="holo-btn flex-1" onClick={onSave}>저장</button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      /* ====== 클라우드 상태 표시 ====== */
      function CloudStatus({ uid, savedAt }){
        return (
          <div className="text-xs muted">
            <span className="mr-2">Cloud</span>
            <span className="mr-2">UID: {uid? (uid.slice(0,8)+'…') : '로그인중…'}</span>
            <span>저장: {savedAt? new Date(savedAt).toLocaleTimeString() : '대기'}</span>
          </div>
        );
      }

      function App(){
        const [state, setState] = useLocalState(APP_KEY, defaultState);
        const [tab, setTab] = useState("dashboard");
        const [stockTab, setStockTab] = useState(STOCKS[0].key);
        const [q, setQ] = useState("");
        const [sortKey, setSortKey] = useState("date");
        const [sortDir, setSortDir] = useState("desc");
        const [editing, setEditing] = useState(null);

        // ✅ Firebase user / 클라우드 동기화
        const [uid, setUid] = useState(null);
        const [savedAt, setSavedAt] = useState(null);
        const docRef = uid ? db.collection("swing-tracker").doc(uid) : null;

        // 로그인 완료 후 uid 확보
        useEffect(()=>{
          userReady.then(u=> setUid(u.uid));
        },[]);

        // 최초 1회: 클라우드에서 불러오기 (있으면 로컬 상태를 덮어씀)
        useEffect(()=>{
          if(!docRef) return;
          (async ()=>{
            try {
              const snap = await docRef.get();
              if (snap.exists) {
                const remote = snap.data();
                // 최소한의 스키마 체크
                if (remote && remote.monthlyPnL && remote.journals) {
                  setState(remote);
                }
              }
            } catch(e){ /* 무시 */ }
          })();
        // eslint-disable-next-line react-hooks/exhaustive-deps
        }, [uid]);

        // 변경사항 -> 500ms 디바운스로 클라우드에 저장
        useEffect(()=>{
          if(!docRef) return;
          const t = setTimeout(async ()=>{
            try {
              await docRef.set(state, { merge: true });
              setSavedAt(Date.now());
            } catch(e){ /* 오프라인이면 자동 실패, 다음 변경 때 재시도 */ }
          }, 500);
          return ()=> clearTimeout(t);
        }, [state, docRef]);

        const realized = useMemo(()=>{
          return ["kakao","samsung","sm"]
            .flatMap(k=>state.journals[k])
            .filter(e=>!e.hold && Number(e.resultPnl||0)!==0);
        }, [state]);

        const totals = useMemo(()=>{
          const monthlyTotal = Object.values(state.monthlyPnL).reduce((s,v)=>s+Number(v||0),0);
          const pnl = realized.reduce((s,e)=>s+Number(e.resultPnl||0),0);
          const initialSeed = Number(state.settings?.initialSeed || 0);
          const currentSeed = initialSeed + pnl;
          const roi = initialSeed>0 ? (pnl / initialSeed) * 100 : 0;
          return { monthlyTotal, pnl, initialSeed, currentSeed, roi };
        }, [state, realized]);

        const filtered = useMemo(()=>{
          let arr = [...state.journals[stockTab]];
          if (q){
            const t=q.toLowerCase();
            arr = arr.filter(e=>[e.date,e.side,e.plan,e.reason,e.notes,e.tags].join(" ").toLowerCase().includes(t));
          }
          const dir = (sortDir==="asc"?1:-1);
          arr.sort((a,b)=> (a[sortKey]>b[sortKey]?dir:-dir));
          return arr;
        }, [state, stockTab, q, sortKey, sortDir]);

        function addEntry(stock){ setEditing({ stock, entry: defaultJournalEntry() }); }
        function editEntry(stock, id){ const e = state.journals[stock].find(x=>x.id===id); if (e) setEditing({ stock, entry: {...e} }); }
        function removeEntry(stock, id){
          if (!confirm("삭제할까요?")) return;
          setState(prev=>({ ...prev, journals: { ...prev.journals, [stock]: prev.journals[stock].filter(e=>e.id!==id) }}));
        }
        function saveEntry(){
          const { stock, entry } = editing;
          setState(prev=>{
            const exists = prev.journals[stock].some(e=>e.id===entry.id);
            const next = exists ? prev.journals[stock].map(e=>e.id===entry.id? entry: e) : [entry, ...prev.journals[stock]];
            return { ...prev, journals: { ...prev.journals, [stock]: next } };
          });
          setEditing(null);
        }

        const setMonthly = (ym, value)=> setState(prev=>({ ...prev, monthlyPnL: { ...prev.monthlyPnL, [ym]: value }}));
        const setInitialSeed = (v)=> setState(prev=>({ ...prev, settings:{ ...prev.settings, initialSeed: v }}));

        return (
          <div className="max-w-7xl mx-auto p-4 pb-24">
            {/* 헤더 */}
            <div className="flex items-center justify-between mb-6">
              <div>
                <h1 className="text-xl font-normal tracking-tight">개인용 스윙 트래커 홈</h1>
                <p className="muted mt-1 text-sm">월 수익 집계 + 3종목(카카오·삼성전자·에스엠) 일지 · 로컬 저장 · Cloud 동기화</p>
              </div>
              <div className="flex gap-2">
                <button className={`glass-btn ${tab==='dashboard' && 'ring-2 ring-blue-200'}`} onClick={()=>setTab('dashboard')}>대시보드</button>
                <button className={`glass-btn ${tab==='journal' && 'ring-2 ring-blue-200'}`} onClick={()=>setTab('journal')}>일지</button>
                <button className={`glass-btn ${tab==='settings' && 'ring-2 ring-blue-200'}`} onClick={()=>setTab('settings')}>설정</button>
              </div>
            </div>

            {/* 대시보드 */}
            {tab==='dashboard' && (
              <div className="grid md:grid-cols-3 gap-4">
                <Section title="월별 실현 손익">
                  <MonthlyPnLTable monthly={state.monthlyPnL} onChange={setMonthly} />
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mt-4">
                    <Stat label="월 합계" value={`${currency(totals.monthlyTotal)} 원`} />
                    <Stat label="현재 시드" value={`${currency(totals.currentSeed)} 원`} />
                    <Stat label="수익률" value={`${pct(totals.roi)} %`} sub={`초기 시드: ${currency(totals.initialSeed)} 원`} />
                    <Stat label="총 일지 수" value={`${['kakao','samsung','sm'].reduce((s,k)=>s+state.journals[k].length,0)} 건`} />
                  </div>
                </Section>

                <Section title="빠른 추가">
                  <div className="flex flex-wrap gap-2">
                    {STOCKS.map(s=> (
                      <button key={s.key} className="holo-btn" onClick={()=>addEntry(s.key)}>새 일지 ({s.name})</button>
                    ))}
                  </div>
                </Section>

                <Section title="가이드" right={<CloudStatus uid={uid} savedAt={savedAt}/>}>
                  <ul className="list-disc pl-5 text-xs muted space-y-1">
                    <li>설정에서 <b>초기 시드</b>를 입력하면 대시보드의 현재 시드·수익률에 반영됩니다.</li>
                    <li>모바일에선 우하단 <b>＋</b> 버튼으로 빠르게 추가하세요.</li>
                    <li>입력 내용은 <b>로컬 + Cloud</b>에 자동 저장됩니다.</li>
                  </ul>
                </Section>
              </div>
            )}

            {/* 일지 */}
            {tab==='journal' && (
              <div className="glass-card p-4">
                <div className="flex flex-wrap items-center justify-between gap-2 mb-3">
                  <div className="flex gap-2">
                    {STOCKS.map(s=> (
                      <button key={s.key} className={`glass-btn ${stockTab===s.key && 'ring-2 ring-blue-200'}`} onClick={()=>setStockTab(s.key)}>{s.name}</button>
                    ))}
                  </div>
                  <div className="flex items-center gap-2">
                    <input className="glass-input w-full max-w-[200px] px-3 py-2" placeholder="검색" value={q} onChange={e=>setQ(e.target.value)} />
                    <select className="glass-select px-3 py-2" value={sortKey} onChange={e=>setSortKey(e.target.value)}>
                      <option value="date">날짜</option><option value="resultPnl">손익</option><option value="emotion">감정</option>
                    </select>
                    <select className="glass-select px-3 py-2" value={sortDir} onChange={e=>setSortDir(e.target.value)}>
                      <option value="desc">내림</option><option value="asc">오름</option>
                    </select>
                    <button className="holo-btn hidden md:inline-flex" onClick={()=>addEntry(stockTab)}>새 일지</button>
                  </div>
                </div>

                {/* 데스크톱 테이블 */}
                <div className="overflow-auto rounded-xl border border-[#eef2f7] hidden md:block">
                  <table className="min-w-full text-sm">
                    <thead className="bg-[#f8fafc]">
                      <tr>
                        {['날짜','사이드','수량','가격','수수료','실현(%)','실현(₩)','보유','감정','태그','메모','작업'].map(h=> <th key={h} className="px-3 py-2 text-left whitespace-nowrap">{h}</th>)}
                      </tr>
                    </thead>
                    <tbody>
                      {filtered.map(e=> (
                        <tr key={e.id} className="hover:bg-[#fafafa]">
                          <td className="px-3 py-2 whitespace-nowrap table-cell">{e.date}</td>
                          <td className="px-3 py-2 whitespace-nowrap table-cell">{e.side}</td>
                          <td className="px-3 py-2 text-right table-cell">{e.qty}</td>
                          <td className="px-3 py-2 text-right table-cell">{e.price}</td>
                          <td className="px-3 py-2 text-right table-cell">{e.fees}</td>
                          <td className="px-3 py-2 text-right table-cell">{e.resultPct}</td>
                          <td className={`px-3 py-2 text-right table-cell ${Number(e.resultPnl||0)>=0? 'text-emerald-600':'text-rose-600'}`}>{e.resultPnl}</td>
                          <td className="px-3 py-2 table-cell">{e.hold? '보유':'-'}</td>
                          <td className="px-3 py-2 text-center table-cell">{e.emotion}</td>
                          <td className="px-3 py-2 table-cell">{e.tags}</td>
                          <td className="px-3 py-2 max-w-[240px] truncate table-cell" title={e.notes}>{e.notes}</td>
                          <td className="px-3 py-2 whitespace-nowrap table-cell">
                            <div className="flex gap-2">
                              <button className="glass-btn" onClick={()=>editEntry(stockTab, e.id)}>수정</button>
                              <button className="glass-btn danger" onClick={()=>removeEntry(stockTab, e.id)}>삭제</button>
                            </div>
                          </td>
                        </tr>
                      ))}
                      {filtered.length===0 && (
                        <tr><td colSpan="12" className="px-3 py-10 text-center muted">기록이 없습니다. 우상단 “새 일지”.</td></tr>
                      )}
                    </tbody>
                  </table>
                </div>

                {/* 모바일 카드 */}
                <div className="space-y-2 md:hidden">
                  {filtered.map(e=>(
                    <div key={e.id} className="border border-[#eef2f7] rounded-xl p-3">
                      <div className="flex items-center justify-between">
                        <div className="text-sm">{e.date} · <span className="muted">{e.side}</span></div>
                        <div className={`${Number(e.resultPnl||0)>=0?'text-emerald-600':'text-rose-600'} text-sm`}>{e.resultPnl||'-'}</div>
                      </div>
                      <div className="grid grid-cols-2 gap-x-4 gap-y-1 mt-2 text-[13px]">
                        <div><span className="meta-label">수량</span> {e.qty||'-'}</div>
                        <div><span className="meta-label">가격</span> {e.price||'-'}</div>
                        <div><span className="meta-label">수수료</span> {e.fees||'-'}</div>
                        <div><span className="meta-label">실현(%)</span> {e.resultPct||'-'}</div>
                        <div><span className="meta-label">태그</span> {e.tags||'-'}</div>
                        <div><span className="meta-label">감정</span> {e.emotion||'-'}</div>
                      </div>
                      {e.notes && <div className="mt-2 text-[13px] text-gray-600">{e.notes}</div>}
                      <div className="mt-3 flex gap-2">
                        <button className="glass-btn" onClick={()=>editEntry(stockTab, e.id)}>수정</button>
                        <button className="glass-btn danger" onClick={()=>removeEntry(stockTab, e.id)}>삭제</button>
                      </div>
                    </div>
                  ))}
                  {filtered.length===0 && <div className="text-center muted py-6 text-sm">아직 기록이 없어요. 우하단 <b>+</b> 버튼으로 추가!</div>}
                </div>
              </div>
            )}

            {/* 설정 */}
            {tab==='settings' && (
              <div className="grid md:grid-cols-2 gap-4">
                <Section title="초기 시드">
                  <div className="flex items-center gap-2">
                    <input inputMode="numeric" pattern="[0-9]*" className="glass-input w-48 px-3 py-2 text-right"
                           value={state.settings.initialSeed}
                           onChange={e=>{
                             const v = Number(String(e.target.value).replace(/[^0-9]/g,'')||0);
                             setInitialSeed(v);
                           }}/>
                    <span className="text-sm">원</span>
                  </div>
                  <p className="text-xs muted mt-2">대시보드의 <b>현재 시드</b>와 <b>수익률</b> 계산에 사용됩니다.</p>
                </Section>

                <Section title="백업/복원">
                  <div className="flex flex-wrap gap-2">
                    <button className="glass-btn" onClick={()=>{
                      const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
                      const url = URL.createObjectURL(blob); const a=document.createElement('a');
                      a.href=url; a.download=`swing-tracker-backup-${Date.now()}.json`; a.click(); URL.revokeObjectURL(url);
                    }}>JSON 백업</button>
                    <label className="glass-btn cursor-pointer">복원
                      <input type="file" accept="application/json" className="hidden" onChange={e=>{
                        const f=e.target.files?.[0]; if(!f) return;
                        const r=new FileReader(); r.onload=()=>{ try{ const data=JSON.parse(r.result); setState(data);}catch{ alert('형식 오류'); } }; r.readAsText(f);
                      }}/>
                    </label>
                  </div>
                  <p className="text-xs muted mt-2">* 데이터는 브라우저와 Cloud에 저장됩니다.</p>
                </Section>

                <Section title="링크 만들기(프라이빗)">
                  <p className="text-xs muted mb-2">상태를 URL 해시(#data=...)로 공유할 수 있어요.</p>
                  <div className="flex gap-2">
                    <button className="holo-btn" onClick={()=>{
                      try{ const link = `${location.href.split('#')[0]}#data=${btoa(JSON.stringify(state))}`;
                        navigator.clipboard.writeText(link); alert('링크를 복사했어요.');
                      }catch(e){ alert('링크 생성 실패'); }
                    }}>링크 복사</button>
                    <button className="glass-btn" onClick={()=>{
                      const link = `${location.href.split('#')[0]}#data=${btoa(JSON.stringify(state))}`;
                      prompt('아래 링크를 복사하세요', link);
                    }}>링크 보기</button>
                  </div>
                </Section>
              </div>
            )}

            <footer className="text-center text-xs muted py-8">스윙 투자 분석 조언가 · 개인용 트래커 · Mobile + Cloud</footer>

            {/* 모바일 FAB */}
            {tab!=='settings' && (
              <div className="fab md:hidden">
                <button className="holo-btn text-base px-4 py-3" aria-label="새 일지 추가" onClick={()=>addEntry(stockTab)}>＋</button>
              </div>
            )}

            {/* 바텀시트 편집기 */}
            <EditorSheet editing={editing} setEditing={setEditing} onSave={saveEntry}/>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
    </script>
  </body>
</html>