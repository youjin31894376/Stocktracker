<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Í∞úÏù∏Ïö© Ïä§Ïúô Ìä∏ÎûòÏª§ Ìôà ¬∑ Holographic (Mobile)</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Pretendard -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css" />
    <!-- React 18 -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase SDK (App, Auth, Firestore) -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
      import { getAuth, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
      import { getFirestore, doc, getDoc, setDoc, enableIndexedDbPersistence } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

      // üîß ÎÑ§ ÌîÑÎ°úÏ†ùÌä∏ ÏÑ§Ï†ï (Í∑∏ÎåÄÎ°ú ÏÇ¨Ïö©)
      const firebaseConfig = {
        apiKey: "AIzaSyBmyHCDjElHWFruKUz1psMF_JlR8xXkdsc",
        authDomain: "stock-tracker-c5203.firebaseapp.com",
        projectId: "stock-tracker-c5203",
        storageBucket: "stock-tracker-c5203.firebasestorage.app",
        messagingSenderId: "653038109673",
        appId: "1:653038109673:web:cc17abb3796a6d4dff0178",
        measurementId: "G-JCT2JK3PP6"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      // Ïò§ÌîÑÎùºÏù∏ Ï∫êÏãú(ÎêòÎ©¥ Ï¢ãÍ≥†, ÏïàÎèºÎèÑ Î¨¥Ïãú)
      enableIndexedDbPersistence(db).catch(() => {});

      // ÏùµÎ™Ö Î°úÍ∑∏Ïù∏ Î≥¥Ïû•
      const userReady = new Promise((resolve) => {
        onAuthStateChanged(auth, async (user) => {
          if (!user) {
            await signInAnonymously(auth).catch(() => {});
          }
          resolve(auth.currentUser);
        });
      });

      // windowÎ°ú ÎÖ∏Ï∂úÌï¥ÏÑú Babel Ïä§ÌÅ¨Î¶ΩÌä∏ÏóêÏÑú Ï†ëÍ∑º Í∞ÄÎä•ÌïòÍ≤å
      window.__fb = { app, auth, db, userReady, getDoc, setDoc, doc };
    </script>

    <style>
      :root { --bg:#fff; --text:#111827; --muted:#6b7280; --shadow:0 6px 20px rgba(0,0,0,.06); --stroke:#e5e7eb; --safe:env(safe-area-inset-bottom,0px); }
      html,body{height:100%;}
      body{font-family:"Pretendard Variable",Pretendard,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Apple SD Gothic Neo","Malgun Gothic",sans-serif;background:var(--bg);color:var(--text);font-size:.9rem;}
      .glass-card{background:#fff;border:1px solid var(--stroke);border-radius:12px;box-shadow:var(--shadow);}
      .glass-input,.glass-select,.glass-textarea{background:#f9fafb;border:1px solid #e5e7eb;color:var(--text);border-radius:10px;transition:.2s ease;font-size:16px;}
      .glass-input:focus,.glass-select:focus,.glass-textarea:focus{outline:none;border-color:#93c5fd;box-shadow:0 0 0 3px rgba(147,197,253,.3);}
      .holo-btn{position:relative;border-radius:12px;padding:10px 14px;color:#0b1220;font-weight:400;cursor:pointer;border:1px solid transparent;background:
        linear-gradient(180deg,rgba(255,255,255,.95),rgba(255,255,255,.7)) padding-box,
        conic-gradient(from 180deg at 50% 50%,#7c3aed,#06b6d4,#22d3ee,#f472b6,#7c3aed) border-box;
        box-shadow:0 10px 24px rgba(0,0,0,.08), inset 0 1px 0 rgba(255,255,255,.7);transition:transform .15s ease, box-shadow .2s ease, background .3s ease;}
      .holo-btn:hover{transform:translateY(-1px);}
      .holo-btn:active{transform:translateY(1px);box-shadow:0 6px 16px rgba(0,0,0,.12), inset 0 1px 0 rgba(255,255,255,.8);}
      .holo-btn::after{content:"";position:absolute;inset:0;border-radius:12px;background:linear-gradient(120deg,rgba(255,255,255,.8),rgba(255,255,255,0) 42%);transform:translateY(-60%);filter:blur(6px);opacity:.35;pointer-events:none;}
      .glass-btn{border-radius:12px;padding:10px 12px;cursor:pointer;background:#f3f4f6;border:1px solid #e5e7eb;color:var(--text);font-size:.9rem;font-weight:400;transition:.2s ease;}
      .glass-btn:hover{transform:translateY(-1px);}
      .danger{color:#dc2626;border-color:#fecaca;}
      table thead{color:#374151;font-weight:400;} table tbody{color:#111827;} .table-cell{border-top:1px solid #f1f5f9;} .muted{color:var(--muted);}
      .sheet{position:fixed;left:0;right:0;bottom:0;z-index:50;background:#fff;border-top-left-radius:16px;border-top-right-radius:16px;box-shadow:0 -10px 30px rgba(0,0,0,.12);transform:translateY(100%);transition:transform .25s ease;padding-bottom:calc(12px + var(--safe));}
      .sheet.open{transform:translateY(0%);} .sheet-handle{width:40px;height:4px;border-radius:9999px;background:#e5e7eb;margin:8px auto 4px;}
      .fab{position:fixed;right:16px;bottom:calc(16px + var(--safe));z-index:40;} .meta-label{font-size:12px;color:#6b7280;}
    </style>
  </head>

  <body class="min-h-screen">
    <div id="root" class="min-h-screen"></div>

    <script type="text/babel">
      const { useState, useMemo, useEffect } = React;

      /* ---------------------- Îç∞Ïù¥ÌÑ∞/Ïú†Ìã∏ ---------------------- */
      const APP_KEY = "swing-home-v2-mobile";
      const STOCKS = [{key:"kakao",name:"Ïπ¥Ïπ¥Ïò§"},{key:"samsung",name:"ÏÇºÏÑ±Ï†ÑÏûê"},{key:"sm",name:"ÏóêÏä§Ïó†"}];

      const defaultJournalEntry = () => ({
        id: (crypto?.randomUUID?.() ?? String(Date.now()+Math.random())),
        date: new Date().toISOString().slice(0,10),
        side:"Îß§Ïàò", qty:"", price:"", fees:"",
        plan:"", reason:"", target:"1% Ï†àÎ∞ò ÏùµÏ†à, 3~5% Ïó∞Ïû•", stop:"ÏµúÎåÄ -2%",
        emotion:3, outcome:"ÏßÑÌñâÏ§ë", resultPct:"", resultPnl:"", hold:false,
        tags:"Ïä§Ïúô", notes:""
      });

      const defaultState = {
        settings:{ initialSeed:16000000 },
        monthlyPnL:{},
        journals:{ kakao:[], samsung:[], sm:[] }
      };

      const currency = (n)=> Number(n||0).toLocaleString();
      const pct = (n)=> isFinite(n)? (Math.round(n*10)/10).toFixed(1):"0.0";

      // Ï†ÄÏû• Í≥ºÎèÑ ÏöîÏ≤≠ Î∞©ÏßÄÏö© ÎîîÎ∞îÏö¥Ïä§
      const debounce = (fn, ms=800) => {
        let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), ms); };
      };

      /* ---------------------- Î°úÏª¨+ÌÅ¥ÎùºÏö∞Îìú ÏÉÅÌÉú ÌõÖ ---------------------- */
      function useCloudedState(key, initial){
        // 1) Ïö∞ÏÑ† Î°úÏª¨
        const [state, setState] = useState(()=>{
          try{
            const hash = new URLSearchParams(location.hash.replace(/^#/, "")).get("data");
            if (hash) return JSON.parse(atob(hash));
          }catch{}
          try{
            const raw = localStorage.getItem(key);
            return raw? JSON.parse(raw): initial;
          }catch{ return initial; }
        });

        // Î°úÏª¨ Ï†ÄÏû•
        useEffect(()=>{ try{ localStorage.setItem(key, JSON.stringify(state)); }catch{} }, [key, state]);

        // 2) ÌååÏù¥Ïñ¥Î≤†Ïù¥Ïä§ ÎèôÍ∏∞Ìôî
        useEffect(()=>{
          let unsub;
          (async ()=>{
            try{
              const fb = window.__fb;
              if (!fb) return; // SDK ÎØ∏Ï¥àÍ∏∞ÌôîÏãú Î¨¥Ïãú
              const user = await fb.userReady;
              if (!user) return;

              const docRef = fb.doc(fb.db, "users", user.uid, "state", key);
              // ÏµúÏ¥à Í∞ÄÏ†∏Ïò§Í∏∞
              const snap = await fb.getDoc(docRef);
              if (snap.exists()){
                const remote = snap.data();
                // ÏµúÏã†(ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÍ∞Å) Í∏∞Ï§Ä Î≥ëÌï© (Îã®Ïàú: remote Ïö∞ÏÑ†)
                if (remote?.__updatedAt && (remote.__updatedAt >= (state.__updatedAt||0))){
                  setState(remote);
                }else{
                  // Î°úÏª¨Ïù¥ ÏµúÏã†Ïù¥Î©¥ ÏóÖÎ°úÎìú
                  await fb.setDoc(docRef, {...state, __updatedAt: Date.now()}, { merge:true });
                }
              }else{
                // Î¨∏ÏÑúÍ∞Ä ÏóÜÏúºÎ©¥ ÏóÖÎ°úÎìú
                await fb.setDoc(docRef, {...state, __updatedAt: Date.now()});
              }

              // Î¶¨Ïä§ÎÑà (Îã§Î•∏ Í∏∞Í∏∞ÏóêÏÑú Î≥ÄÍ≤ΩÎêòÎ©¥ Ïã§ÏãúÍ∞Ñ Î∞òÏòÅ)
              unsub = (await import("https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js"))
                .onSnapshot(docRef, (sn)=>{
                  if (!sn.exists()) return;
                  const d = sn.data();
                  // ÎÇ¥ Ï†ÄÏû• Î£®ÌîÑÏôÄ Ï∂©Îèå Î∞©ÏßÄ: Îçî ÏµúÏã†Îßå Î∞òÏòÅ
                  if (d?.__updatedAt && d.__updatedAt > (state.__updatedAt||0)){
                    setState(d);
                  }
                });

              // Î≥ÄÍ≤ΩÏãú Ï†ÄÏû• (ÎîîÎ∞îÏö¥Ïä§)
              const save = debounce(async (next)=>{
                try{
                  await fb.setDoc(docRef, {...next, __updatedAt: Date.now()}, { merge:true });
                }catch(e){}
              }, 900);

              // state Î≥ÄÍ≤Ω Í∞êÏßÄ Ìö®Í≥º
              const off = new MutationObserver(()=>{}); // dummy(Ï∞∏Ï°∞ Ïú†ÏßÄ)
              const stop = ()=> off.disconnect();
              // Í∞ÑÎã®Ìûà Î≥ÑÎèÑ effectÎ°ú Íµ¨ÌòÑ
              let prev = JSON.stringify(state);
              const i = setInterval(()=>{
                const cur = JSON.stringify(state);
                if (cur !== prev){
                  prev = cur;
                  save(JSON.parse(cur));
                }
              }, 600);
              // cleanup
              return ()=>{ clearInterval(i); stop(); };
            }catch(e){}
          })();
          return ()=>{ if (unsub) try{unsub();}catch{} };
        }, []); // Ï¥àÍ∏∞ 1Ìöå: Î¶¨Ïä§ÎÑà ÏÑ§Ïπò

        return [state, setState];
      }

      /* ---------------------- Í≥µÌÜµ UI ---------------------- */
      const Section = ({title, right, children}) => (
        <div className="glass-card p-4">
          <div className="flex items-center justify-between mb-3">
            <h3 className="text-base font-normal">{title}</h3>
            <div className="flex items-center gap-2">{right}</div>
          </div>
          {children}
        </div>
      );

      const Stat = ({label, value, sub}) => (
        <div className="glass-card p-3">
          <div className="text-xs muted">{label}</div>
          <div className="text-lg font-normal">{value}</div>
          {sub && <div className="text-xs muted mt-1">{sub}</div>}
        </div>
      );

      function MonthlyPnLTable({ monthly, onChange }){
        const [year, setYear] = useState(new Date().getFullYear());
        const months = Array.from({length:12}, (_,i)=>i+1);
        const ym = (y,m)=> `${y}-${String(m).padStart(2,"0")}`;
        return (
          <div>
            <div className="flex items-center gap-2 mb-2">
              <span className="text-xs muted">Ïó∞ÎèÑ</span>
              <select className="glass-select px-2 py-1" value={year} onChange={e=>setYear(Number(e.target.value))}>
                {Array.from({length:6},(_,i)=>new Date().getFullYear()-3+i).map(y=><option key={y} value={y}>{y}</option>)}
              </select>
            </div>
            <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
              {months.map(m=>{
                const key = ym(year, m);
                const v = monthly[key] ?? "";
                return (
                  <div key={key} className="glass-card p-2">
                    <div className="text-xs muted mb-1">{year}ÎÖÑ {m}Ïõî</div>
                    <input className="glass-input w-full px-3 py-2 text-right" placeholder="Ïòà: 140000" value={v}
                      onChange={e=>onChange(key, e.target.value)} />
                  </div>
                );
              })}
            </div>
          </div>
        );
      }

      function EditorSheet({ editing, setEditing, onSave }){
        if(!editing) return null;
        const { entry, stock } = editing;
        const update = (k,v)=> setEditing(p=> ({...p, entry:{...p.entry, [k]:v}}));
        return (
          <div className="sheet open">
            <div className="sheet-handle"></div>
            <div className="px-4 pt-2 pb-3">
              <div className="flex items-center justify-between">
                <div className="text-sm muted">ÏùºÏßÄ ÏûÖÎ†• ¬∑ {stock}</div>
                <button className="glass-btn" onClick={()=>setEditing(null)}>Îã´Í∏∞</button>
              </div>

              <div className="grid grid-cols-2 gap-3 mt-3">
                <div><div className="text-xs muted mb-1">ÎÇ†Ïßú</div>
                  <input type="date" className="glass-input w-full px-3 py-2" value={entry.date} onChange={e=>update("date", e.target.value)}/>
                </div>
                <div><div className="text-xs muted mb-1">ÏÇ¨Ïù¥Îìú</div>
                  <select className="glass-input w-full px-3 py-2" value={entry.side} onChange={e=>update("side", e.target.value)}>
                    <option>Îß§Ïàò</option><option>Îß§ÎèÑ</option><option>Í¥ÄÎßù</option><option>Ï≤≠ÏÇ∞</option>
                  </select>
                </div>
                <div><div className="text-xs muted mb-1">ÏàòÎüâ</div>
                  <input inputMode="numeric" pattern="[0-9]*" className="glass-input w-full px-3 py-2" value={entry.qty} onChange={e=>update("qty", e.target.value)}/>
                </div>
                <div><div className="text-xs muted mb-1">Í∞ÄÍ≤©</div>
                  <input inputMode="decimal" className="glass-input w-full px-3 py-2" value={entry.price} onChange={e=>update("price", e.target.value)}/>
                </div>
                <div><div className="text-xs muted mb-1">ÏàòÏàòÎ£å/ÏÑ∏Í∏à</div>
                  <input inputMode="decimal" className="glass-input w-full px-3 py-2" value={entry.fees} onChange={e=>update("fees", e.target.value)}/>
                </div>
                <div><div className="text-xs muted mb-1">Í∞êÏ†ï(1~5)</div>
                  <input type="number" min="1" max="5" className="glass-input w-full px-3 py-2" value={entry.emotion} onChange={e=>update("emotion", e.target.value)}/>
                </div>
                <div className="col-span-2"><div className="text-xs muted mb-1">Î∂ÄÎ∂ÑÏùµÏ†à/Î™©Ìëú</div>
                  <input className="glass-input w-full px-3 py-2" value={entry.target} onChange={e=>update("target", e.target.value)}/>
                </div>
                <div className="col-span-2"><div className="text-xs muted mb-1">Î¶¨Ïä§ÌÅ¨/ÏÜêÏ†à</div>
                  <input className="glass-input w-full px-3 py-2" value={entry.stop} onChange={e=>update("stop", e.target.value)}/>
                </div>
                <div className="col-span-2"><div className="text-xs muted mb-1">ÏßÑÏûÖ Í≥ÑÌöç(ÏãúÎÇòÎ¶¨Ïò§)</div>
                  <textarea rows="2" className="glass-input w-full px-3 py-2" value={entry.plan} onChange={e=>update("plan", e.target.value)}></textarea>
                </div>
                <div className="col-span-2"><div className="text-xs muted mb-1">Ïã§Ìñâ/Ï¢ÖÎ£å Ïù¥Ïú†</div>
                  <textarea rows="2" className="glass-input w-full px-3 py-2" value={entry.reason} onChange={e=>update("reason", e.target.value)}></textarea>
                </div>
                <div><div className="text-xs muted mb-1">Ïã§ÌòÑ ÏàòÏùµÎ•†(%)</div>
                  <input inputMode="decimal" className="glass-input w-full px-3 py-2" value={entry.resultPct} onChange={e=>update("resultPct", e.target.value)}/>
                </div>
                <div><div className="text-xs muted mb-1">Ïã§ÌòÑ ÏÜêÏùµ(‚Ç©)</div>
                  <input inputMode="decimal" className="glass-input w-full px-3 py-2" value={entry.resultPnl} onChange={e=>update("resultPnl", e.target.value)}/>
                </div>
                <div><div className="text-xs muted mb-1">Î≥¥Ïú†</div>
                  <select className="glass-input w-full px-3 py-2" value={entry.hold? "Y":"N"} onChange={e=>update("hold", e.target.value==="Y")}>
                    <option value="N">ÏïÑÎãàÏò§</option><option value="Y">Ïòà</option>
                  </select>
                </div>
                <div><div className="text-xs muted mb-1">ÌÉúÍ∑∏</div>
                  <input className="glass-input w-full px-3 py-2" value={entry.tags} onChange={e=>update("tags", e.target.value)}/>
                </div>
                <div className="col-span-2"><div className="text-xs muted mb-1">Î©îÎ™®</div>
                  <textarea rows="2" className="glass-input w-full px-3 py-2" value={entry.notes} onChange={e=>update("notes", e.target.value)}></textarea>
                </div>
              </div>

              <div className="sticky bottom-0 bg-white pt-3 mt-3">
                <div className="flex gap-2">
                  <button className="glass-btn flex-1" onClick={()=>setEditing(null)}>Ï∑®ÏÜå</button>
                  <button className="holo-btn flex-1" onClick={onSave}>Ï†ÄÏû•</button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      /* ---------------------- Î©îÏù∏ App ---------------------- */
      function App(){
        const [state, setState] = useCloudedState(APP_KEY, defaultState);
        const [tab, setTab] = useState("dashboard");
        const [stockTab, setStockTab] = useState(STOCKS[0].key);
        const [q, setQ] = useState("");
        const [sortKey, setSortKey] = useState("date");
        const [sortDir, setSortDir] = useState("desc");
        const [editing, setEditing] = useState(null);

        const realized = useMemo(()=>(
          ["kakao","samsung","sm"]
            .flatMap(k=>state.journals[k])
            .filter(e=>!e.hold && Number(e.resultPnl||0)!==0)
        ), [state]);

        const totals = useMemo(()=>{
          const monthlyTotal = Object.values(state.monthlyPnL).reduce((s,v)=>s+Number(v||0),0);
          const pnl = realized.reduce((s,e)=>s+Number(e.resultPnl||0),0);
          const initialSeed = Number(state.settings?.initialSeed || 0);
          const currentSeed = initialSeed + pnl;
          const roi = initialSeed>0 ? (pnl/initialSeed)*100 : 0;
          return { monthlyTotal, pnl, initialSeed, currentSeed, roi };
        }, [state, realized]);

        const filtered = useMemo(()=>{
          let arr = [...state.journals[stockTab]];
          if (q){
            const t=q.toLowerCase();
            arr = arr.filter(e=>[e.date,e.side,e.plan,e.reason,e.notes,e.tags].join(" ").toLowerCase().includes(t));
          }
          const dir = (sortDir==="asc"?1:-1);
          arr.sort((a,b)=> (a[sortKey]>b[sortKey]?dir:-dir));
          return arr;
        }, [state, stockTab, q, sortKey, sortDir]);

        function addEntry(stock){ setEditing({ stock, entry: defaultJournalEntry() }); }
        function editEntry(stock, id){ const e = state.journals[stock].find(x=>x.id===id); if (e) setEditing({ stock, entry: {...e} }); }
        function removeEntry(stock, id){
          if (!confirm("ÏÇ≠Ï†úÌï†ÍπåÏöî?")) return;
          setState(prev=>({ ...prev, journals:{ ...prev.journals, [stock]: prev.journals[stock].filter(e=>e.id!==id) }}));
        }
        function saveEntry(){
          const { stock, entry } = editing;
          setState(prev=>{
            const exists = prev.journals[stock].some(e=>e.id===entry.id);
            const next = exists ? prev.journals[stock].map(e=>e.id===entry.id? entry: e) : [entry, ...prev.journals[stock]];
            return { ...prev, journals:{ ...prev.journals, [stock]: next }, __updatedAt: Date.now() };
          });
          setEditing(null);
        }

        const setMonthly = (ym, value)=> setState(prev=>({ ...prev, monthlyPnL:{ ...prev.monthlyPnL, [ym]: value }, __updatedAt: Date.now() }));
        const setInitialSeed = (v)=> setState(prev=>({ ...prev, settings:{ ...prev.settings, initialSeed: v }, __updatedAt: Date.now() }));

        return (
          <div className="max-w-7xl mx-auto p-4 pb-24">
            {/* Ìó§Îçî */}
            <div className="flex items-center justify-between mb-6">
              <div>
                <h1 className="text-xl font-normal tracking-tight">Í∞úÏù∏Ïö© Ïä§Ïúô Ìä∏ÎûòÏª§ Ìôà</h1>
                <p className="muted mt-1 text-sm">Ïõî ÏàòÏùµ ÏßëÍ≥Ñ + 3Ï¢ÖÎ™©(Ïπ¥Ïπ¥Ïò§¬∑ÏÇºÏÑ±Ï†ÑÏûê¬∑ÏóêÏä§Ïó†) ÏùºÏßÄ ¬∑ Î°úÏª¨/ÌÅ¥ÎùºÏö∞Îìú Ï†ÄÏû•</p>
              </div>
              <div className="flex gap-2">
                <button className={`glass-btn ${tab==='dashboard' && 'ring-2 ring-blue-200'}`} onClick={()=>setTab('dashboard')}>ÎåÄÏãúÎ≥¥Îìú</button>
                <button className={`glass-btn ${tab==='journal' && 'ring-2 ring-blue-200'}`} onClick={()=>setTab('journal')}>ÏùºÏßÄ</button>
                <button className={`glass-btn ${tab==='settings' && 'ring-2 ring-blue-200'}`} onClick={()=>setTab('settings')}>ÏÑ§Ï†ï</button>
              </div>
            </div>

            {/* ÎåÄÏãúÎ≥¥Îìú */}
            {tab==='dashboard' && (
              <div className="grid md:grid-cols-3 gap-4">
                <Section title="ÏõîÎ≥Ñ Ïã§ÌòÑ ÏÜêÏùµ">
                  <MonthlyPnLTable monthly={state.monthlyPnL} onChange={setMonthly} />
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mt-4">
                    <Stat label="Ïõî Ìï©Í≥Ñ" value={`${currency(totals.monthlyTotal)} Ïõê`} />
                    <Stat label="ÌòÑÏû¨ ÏãúÎìú" value={`${currency(totals.currentSeed)} Ïõê`} />
                    <Stat label="ÏàòÏùµÎ•†" value={`${pct(totals.roi)} %`} sub={`Ï¥àÍ∏∞ ÏãúÎìú: ${currency(totals.initialSeed)} Ïõê`} />
                    <Stat label="Ï¥ù ÏùºÏßÄ Ïàò" value={`${['kakao','samsung','sm'].reduce((s,k)=>s+state.journals[k].length,0)} Í±¥`} />
                  </div>
                </Section>

                <Section title="Îπ†Î•∏ Ï∂îÍ∞Ä">
                  <div className="flex flex-wrap gap-2">
                    {STOCKS.map(s=> (
                      <button key={s.key} className="holo-btn" onClick={()=>addEntry(s.key)}>ÏÉà ÏùºÏßÄ ({s.name})</button>
                    ))}
                  </div>
                </Section>

                <Section title="Í∞ÄÏù¥Îìú">
                  <ul className="list-disc pl-5 text-xs muted space-y-1">
                    <li>ÏÑ§Ï†ïÏóêÏÑú <b>Ï¥àÍ∏∞ ÏãúÎìú</b>Î•º ÏûÖÎ†•ÌïòÎ©¥ ÎåÄÏãúÎ≥¥ÎìúÏùò ÌòÑÏû¨ ÏãúÎìú¬∑ÏàòÏùµÎ•†Ïóê Î∞òÏòÅÎèºÏöî.</li>
                    <li>ÏùºÏßÄÎäî ÌïòÎã® <b>Ôºã</b> Î≤ÑÌäº(Î™®Î∞îÏùº)ÏúºÎ°ú Îπ†Î•¥Í≤å Ï∂îÍ∞ÄÌïòÏÑ∏Ïöî.</li>
                    <li>JSON Î∞±ÏóÖ/Î≥µÏõê + Firebase ÎèôÍ∏∞ÌôîÎ°ú ÏïàÏ†ÑÌïòÍ≤å Î≥¥Í¥ÄÎê©ÎãàÎã§.</li>
                  </ul>
                </Section>
              </div>
            )}

            {/* ÏùºÏßÄ */}
            {tab==='journal' && (
              <div className="glass-card p-4">
                <div className="flex flex-wrap items-center justify-between gap-2 mb-3">
                  <div className="flex gap-2">
                    {STOCKS.map(s=> (
                      <button key={s.key} className={`glass-btn ${stockTab===s.key && 'ring-2 ring-blue-200'}`} onClick={()=>setStockTab(s.key)}>{s.name}</button>
                    ))}
                  </div>
                  <div className="flex items-center gap-2">
                    <input className="glass-input w-full max-w-[200px] px-3 py-2" placeholder="Í≤ÄÏÉâ" value={q} onChange={e=>setQ(e.target.value)} />
                    <select className="glass-select px-3 py-2" value={sortKey} onChange={e=>setSortKey(e.target.value)}>
                      <option value="date">ÎÇ†Ïßú</option><option value="resultPnl">ÏÜêÏùµ</option><option value="emotion">Í∞êÏ†ï</option>
                    </select>
                    <select className="glass-select px-3 py-2" value={sortDir} onChange={e=>setSortDir(e.target.value)}>
                      <option value="desc">ÎÇ¥Î¶º</option><option value="asc">Ïò§Î¶Ñ</option>
                    </select>
                    <button className="holo-btn hidden md:inline-flex" onClick={()=>addEntry(stockTab)}>ÏÉà ÏùºÏßÄ</button>
                  </div>
                </div>

                {/* Îç∞Ïä§ÌÅ¨ÌÜ± ÌÖåÏù¥Î∏î */}
                <div className="overflow-auto rounded-xl border border-[#eef2f7] hidden md:block">
                  <table className="min-w-full text-sm">
                    <thead className="bg-[#f8fafc]">
                      <tr>{['ÎÇ†Ïßú','ÏÇ¨Ïù¥Îìú','ÏàòÎüâ','Í∞ÄÍ≤©','ÏàòÏàòÎ£å','Ïã§ÌòÑ(%)','Ïã§ÌòÑ(‚Ç©)','Î≥¥Ïú†','Í∞êÏ†ï','ÌÉúÍ∑∏','Î©îÎ™®','ÏûëÏóÖ'].map(h=> <th key={h} className="px-3 py-2 text-left whitespace-nowrap">{h}</th>)}</tr>
                    </thead>
                    <tbody>
                      {filtered.map(e=> (
                        <tr key={e.id} className="hover:bg-[#fafafa]">
                          <td className="px-3 py-2 whitespace-nowrap table-cell">{e.date}</td>
                          <td className="px-3 py-2 whitespace-nowrap table-cell">{e.side}</td>
                          <td className="px-3 py-2 text-right table-cell">{e.qty}</td>
                          <td className="px-3 py-2 text-right table-cell">{e.price}</td>
                          <td className="px-3 py-2 text-right table-cell">{e.fees}</td>
                          <td className="px-3 py-2 text-right table-cell">{e.resultPct}</td>
                          <td className={`px-3 py-2 text-right table-cell ${Number(e.resultPnl||0)>=0? 'text-emerald-600':'text-rose-600'}`}>{e.resultPnl}</td>
                          <td className="px-3 py-2 table-cell">{e.hold? 'Î≥¥Ïú†':'-'}</td>
                          <td className="px-3 py-2 text-center table-cell">{e.emotion}</td>
                          <td className="px-3 py-2 table-cell">{e.tags}</td>
                          <td className="px-3 py-2 max-w-[240px] truncate table-cell" title={e.notes}>{e.notes}</td>
                          <td className="px-3 py-2 whitespace-nowrap table-cell">
                            <div className="flex gap-2">
                              <button className="glass-btn" onClick={()=>editEntry(stockTab, e.id)}>ÏàòÏ†ï</button>
                              <button className="glass-btn danger" onClick={()=>removeEntry(stockTab, e.id)}>ÏÇ≠Ï†ú</button>
                            </div>
                          </td>
                        </tr>
                      ))}
                      {filtered.length===0 && (<tr><td colSpan="12" className="px-3 py-10 text-center muted">Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§. Ïö∞ÏÉÅÎã® ‚ÄúÏÉà ÏùºÏßÄ‚Äù.</td></tr>)}
                    </tbody>
                  </table>
                </div>

                {/* Î™®Î∞îÏùº Ïπ¥Îìú */}
                <div className="space-y-2 md:hidden">
                  {filtered.map(e=>(
                    <div key={e.id} className="border border-[#eef2f7] rounded-xl p-3">
                      <div className="flex items-center justify-between">
                        <div className="text-sm">{e.date} ¬∑ <span className="muted">{e.side}</span></div>
                        <div className={`${Number(e.resultPnl||0)>=0?'text-emerald-600':'text-rose-600'} text-sm`}>{e.resultPnl||'-'}</div>
                      </div>
                      <div className="grid grid-cols-2 gap-x-4 gap-y-1 mt-2 text-[13px]">
                        <div><span className="meta-label">ÏàòÎüâ</span> {e.qty||'-'}</div>
                        <div><span className="meta-label">Í∞ÄÍ≤©</span> {e.price||'-'}</div>
                        <div><span className="meta-label">ÏàòÏàòÎ£å</span> {e.fees||'-'}</div>
                        <div><span className="meta-label">Ïã§ÌòÑ(%)</span> {e.resultPct||'-'}</div>
                        <div><span className="meta-label">ÌÉúÍ∑∏</span> {e.tags||'-'}</div>
                        <div><span className="meta-label">Í∞êÏ†ï</span> {e.emotion||'-'}</div>
                      </div>
                      {e.notes && <div className="mt-2 text-[13px] text-gray-600">{e.notes}</div>}
                      <div className="mt-3 flex gap-2">
                        <button className="glass-btn" onClick={()=>editEntry(stockTab, e.id)}>ÏàòÏ†ï</button>
                        <button className="glass-btn danger" onClick={()=>removeEntry(stockTab, e.id)}>ÏÇ≠Ï†ú</button>
                      </div>
                    </div>
                  ))}
                  {filtered.length===0 && <div className="text-center muted py-6 text-sm">ÏïÑÏßÅ Í∏∞Î°ùÏù¥ ÏóÜÏñ¥Ïöî. Ïö∞ÌïòÎã® <b>+</b> Î≤ÑÌäºÏúºÎ°ú Ï∂îÍ∞Ä!</div>}
                </div>
              </div>
            )}

            {/* ÏÑ§Ï†ï */}
            {tab==='settings' && (
              <div className="grid md:grid-cols-2 gap-4">
                <Section title="Ï¥àÍ∏∞ ÏãúÎìú">
                  <div className="flex items-center gap-2">
                    <input inputMode="numeric" pattern="[0-9]*" className="glass-input w-48 px-3 py-2 text-right"
                      value={state.settings.initialSeed}
                      onChange={e=>{ const v = Number(String(e.target.value).replace(/[^0-9]/g,'')||0); setInitialSeed(v); }}/>
                    <span className="text-sm">Ïõê</span>
                  </div>
                  <p className="text-xs muted mt-2">ÎåÄÏãúÎ≥¥ÎìúÏùò <b>ÌòÑÏû¨ ÏãúÎìú</b>ÏôÄ <b>ÏàòÏùµÎ•†</b> Í≥ÑÏÇ∞Ïóê ÏÇ¨Ïö©Îê©ÎãàÎã§.</p>
                </Section>

                <Section title="Î∞±ÏóÖ/Î≥µÏõê (JSON)">
                  <div className="flex flex-wrap gap-2">
                    <button className="glass-btn" onClick={()=>{
                      const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
                      const url=URL.createObjectURL(blob); const a=document.createElement('a');
                      a.href=url; a.download=`swing-tracker-backup-${Date.now()}.json`; a.click(); URL.revokeObjectURL(url);
                    }}>JSON Î∞±ÏóÖ</button>
                    <label className="glass-btn cursor-pointer">Î≥µÏõê
                      <input type="file" accept="application/json" className="hidden" onChange={e=>{
                        const f=e.target.files?.[0]; if(!f) return;
                        const r=new FileReader(); r.onload=()=>{ try{ const data=JSON.parse(r.result); data.__updatedAt=Date.now(); setState(data);}catch{ alert('ÌòïÏãù Ïò§Î•ò'); } }; r.readAsText(f);
                      }}/>
                    </label>
                  </div>
                  <p className="text-xs muted mt-2">* Îç∞Ïù¥ÌÑ∞Îäî Î°úÏª¨Í≥º Firebase Î™®ÎëêÏóê ÎèôÍ∏∞ÌôîÎê©ÎãàÎã§.</p>
                </Section>

                <Section title="ÌÅ¥ÎùºÏö∞Îìú ÎèôÍ∏∞Ìôî ÏÉÅÌÉú">
                  <CloudStatus />
                </Section>
              </div>
            )}

            <footer className="text-center text-xs muted py-8">Ïä§Ïúô Ìà¨Ïûê Î∂ÑÏÑù Ï°∞Ïñ∏Í∞Ä ¬∑ Í∞úÏù∏Ïö© Ìä∏ÎûòÏª§ ¬∑ Mobile + Cloud</footer>

            {/* Î™®Î∞îÏùº FAB */}
            {tab!=='settings' && (
              <div className="fab md:hidden">
                <button className="holo-btn text-base px-4 py-3" aria-label="ÏÉà ÏùºÏßÄ Ï∂îÍ∞Ä" onClick={()=>addEntry(stockTab)}>Ôºã</button>
              </div>
            )}

            {/* Î∞îÌÖÄÏãúÌä∏ Ìé∏ÏßëÍ∏∞ */}
            <EditorSheet editing={editing} setEditing={setEditing} onSave={saveEntry}/>
          </div>
        );
      }

      // Í∞ÑÎã®Ìïú ÌÅ¥ÎùºÏö∞Îìú ÏÉÅÌÉú ÌëúÏãú Ïª¥Ìè¨ÎÑåÌä∏
      function CloudStatus(){
        const fb = window.__fb;
        const [uid, setUid] = useState(null);
        useEffect(()=>{ (async()=>{ try{ const u = await fb?.userReady; setUid(u?.uid || null); }catch{} })(); },[]);
        return (
          <div className="text-sm">
            <div className="mb-2">Î°úÍ∑∏Ïù∏: <span className="muted">{uid? 'ÏùµÎ™Ö ('+uid.slice(0,8)+'‚Ä¶)':'ÌôïÏù∏ Ï§ë‚Ä¶'}</span></div>
            <div className="muted">* ÎèôÏùº Í∏∞Í∏∞/Î∏åÎùºÏö∞Ï†ÄÎ©¥ Í∞ôÏùÄ ÏùµÎ™Ö Í≥ÑÏ†ïÏúºÎ°ú Ïù¥Ïñ¥Ï†∏Ïöî.</div>
          </div>
        );
      }

      const rootEl = document.getElementById("root");
      ReactDOM.createRoot(rootEl).render(<App/>);
    </script>
  </body>
</html>